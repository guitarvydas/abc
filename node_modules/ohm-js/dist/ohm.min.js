!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ohm={})}(this,(function(t){"use strict";function e(t){const e=t||"";return function(){throw new Error("this method "+e+" is abstract! (it has no implementation in class "+this.constructor.name+")")}}function r(t,e){if(!t)throw new Error(e||"Assertion failed")}function n(t,e,r){let n;Object.defineProperty(t,e,{get(){return n||(n=r.call(this)),n}})}function i(t,e){const r=[];for(;e-- >0;)r.push(t());return r}function s(t,e){return new Array(e+1).join(t)}function o(t,e){return i((()=>t),e)}function a(t){const e=[];for(let r=0;r<t.length;r++){const n=t[r];t.lastIndexOf(n)!==r&&e.indexOf(n)<0&&e.push(n)}return e}function u(t){const e=[];return t.forEach((t=>{e.indexOf(t)<0&&e.push(t)})),e}function c(t){const e=t[0];return e===e.toUpperCase()}function l(t){return!c(t)}function p(t,e,r){const n=r||" ";return t.length<e?s(n,e-t.length)+t:t}function h(){this.strings=[]}h.prototype.append=function(t){this.strings.push(t)},h.prototype.contents=function(){return this.strings.join("")};const m=t=>String.fromCodePoint(parseInt(t,16));function d(t){if("\\"!==t.charAt(0))return t;switch(t.charAt(1)){case"b":return"\b";case"f":return"\f";case"n":return"\n";case"r":return"\r";case"t":return"\t";case"v":return"\v";case"x":return m(t.slice(2,4));case"u":return"{"===t.charAt(2)?m(t.slice(3,-1)):m(t.slice(2,6));default:return t.charAt(1)}}function f(t){if(null==t)return String(t);const e=Object.prototype.toString.call(t);try{let r;return r=t.constructor&&t.constructor.name?t.constructor.name:0===e.indexOf("[object ")?e.slice(8,-1):typeof t,r+": "+JSON.stringify(String(t))}catch(t){return e}}var g=Object.freeze({__proto__:null,abstract:e,assert:r,defineLazyProperty:n,clone:function(t){return t?Object.assign({},t):t},repeatFn:i,repeatStr:s,repeat:o,getDuplicates:a,copyWithoutDuplicates:u,isSyntactic:c,isLexical:l,padLeft:p,StringBuffer:h,unescapeCodePoint:d,unexpectedObjToString:f});const v={Lu:/\p{Lu}/u,Ll:/\p{Ll}/u,Lt:/\p{Lt}/u,Lm:/\p{Lm}/u,Lo:/\p{Lo}/u,Nl:/\p{Nl}/u,Nd:/\p{Nd}/u,Mn:/\p{Mn}/u,Mc:/\p{Mc}/u,Pc:/\p{Pc}/u,Zs:/\p{Zs}/u,L:/\p{Letter}/u,Ltmo:/\p{Lt}|\p{Lm}|\p{Lo}/u};class I{constructor(){if(this.constructor===I)throw new Error("PExpr cannot be instantiated -- it's abstract")}withSource(t){return t&&(this.source=t.trimmed()),this}}const y=Object.create(I.prototype),x=Object.create(I.prototype);class S extends I{constructor(t){super(),this.obj=t}}class b extends I{constructor(t,e){super(),this.from=t,this.to=e,this.matchCodePoint=t.length>1||e.length>1}}class _ extends I{constructor(t){super(),this.index=t}}class w extends I{constructor(t){super(),this.terms=t}}class A extends w{constructor(t,e,r){super([r,t.rules[e].body]),this.superGrammar=t,this.name=e,this.body=r}}class N extends w{constructor(t,e,r,n){const i=t.rules[e].body;super([...r,i,...n]),this.superGrammar=t,this.ruleName=e,this.expansionPos=r.length}}class O extends I{constructor(t){super(),this.factors=t}}class L extends I{constructor(t){super(),this.expr=t}}class R extends L{}class F extends L{}class P extends L{}R.prototype.operator="*",F.prototype.operator="+",P.prototype.operator="?",R.prototype.minNumMatches=0,F.prototype.minNumMatches=1,P.prototype.minNumMatches=0,R.prototype.maxNumMatches=Number.POSITIVE_INFINITY,F.prototype.maxNumMatches=Number.POSITIVE_INFINITY,P.prototype.maxNumMatches=1;class E extends I{constructor(t){super(),this.expr=t}}class C extends I{constructor(t){super(),this.expr=t}}class T extends I{constructor(t){super(),this.expr=t}}class k extends I{constructor(t,e=[]){super(),this.ruleName=t,this.args=e}isSyntactic(){return c(this.ruleName)}toMemoKey(){return this._memoKey||Object.defineProperty(this,"_memoKey",{value:this.toString()}),this._memoKey}}class D extends I{constructor(t){super(),this.category=t,this.pattern=v[t]}}function j(t,e){let r;return e?(r=new Error(e.getLineAndColumnMessage()+t),r.shortMessage=t,r.interval=e):r=new Error(t),r}function M(){return j("Interval sources don't match")}function G(t,e,r){return j("Rule "+t+" is not declared in grammar "+e,r)}function B(t,e,r,n){let i="Duplicate declaration for rule '"+t+"' in grammar '"+e+"'";return e!==r&&(i+=" (originally declared in '"+r+"')"),j(i,n)}function q(t,e,r,n){return j("Wrong number of parameters for rule "+t+" (expected "+e+", got "+r+")",n)}function U(t,e,r){return j("Duplicate parameter names in rule "+t+": "+e.join(", "),r)}const $="NOTE: A _syntactic rule_ is a rule whose name begins with a capital letter. See https://ohmjs.org/d/svl for more details.";function z(t,e){return j("Incorrect argument type: expected "+t,e.source)}function K(t,e){const r=e.length>0?e[e.length-1].args:[];let n="Nullable expression "+t.expr.substituteParams(r)+" is not allowed inside '"+t.operator+"' (possible infinite loop)";if(e.length>0){n+="\nApplication stack (most recent application last):\n"+e.map((t=>new k(t.ruleName,t.args))).join("\n")}return j(n,t.expr.source)}function H(t,e,r,n){return j("Rule "+t+" involves an alternation which has inconsistent arity (expected "+e+", got "+r+")",n.source)}function V(t){if(1===t.length)throw t[0];if(t.length>1)throw function(t){const e=t.map((t=>t.message));return j(["Errors:"].concat(e).join("\n- "),t[0].interval)}(t)}function W(t,e,r){const n=t.length;return(t.slice(0,r)+e+t.slice(r+e.length)).substr(0,n)}function J(...t){const e=this,{offset:n}=e,{repeatStr:i}=g,s=new h;s.append("Line "+e.lineNum+", col "+e.colNum+":\n");const o=function(t){let e=0;return t.map((t=>{const r=t.toString();return e=Math.max(e,r.length),r})).map((t=>p(t,e)))}([null==e.prevLine?0:e.lineNum-1,e.lineNum,null==e.nextLine?0:e.lineNum+1]),a=(t,e,r)=>{s.append(r+o[t]+" | "+e+"\n")};null!=e.prevLine&&a(0,e.prevLine,"  "),a(1,e.line,"> ");const u=e.line.length;let c=i(" ",u+1);for(let s=0;s<t.length;++s){let o=t[s][0],a=t[s][1];r(o>=0&&o<=a,"range start must be >= 0 and <= end");const l=n-e.colNum+1;o=Math.max(0,o-l),a=Math.min(a-l,u),c=W(c,i("~",a-o),o)}const l=2+o[1].length+3;return s.append(i(" ",l)),c=W(c,"^",e.colNum-1),s.append(c.replace(/ +$/,"")+"\n"),null!=e.nextLine&&a(2,e.nextLine,"  "),s.contents()}let Q=[];function Z(t){Q.push(t)}function Y(t,e){let r=1,n=1,i=0,s=0,o=null,a=null,u=-1;for(;i<e;){const e=t.charAt(i++);"\n"===e?(r++,n=1,u=s,s=i):"\r"!==e&&n++}let c=t.indexOf("\n",s);if(-1===c)c=t.length;else{const e=t.indexOf("\n",c+1);o=-1===e?t.slice(c):t.slice(c,e),o=o.replace(/^\r?\n/,"").replace(/\r$/,"")}u>=0&&(a=t.slice(u,s).replace(/\r?\n$/,""));return{offset:e,lineNum:r,colNum:n,line:t.slice(s,c).replace(/\r$/,""),prevLine:a,nextLine:o,toString:J}}function X(t,e,...r){return Y(t,e).toString(...r)}const tt=(()=>{let t=0;return e=>""+e+t++})();class et{constructor(t,e,r){this.sourceString=t,this.startIdx=e,this.endIdx=r}get contents(){return void 0===this._contents&&(this._contents=this.sourceString.slice(this.startIdx,this.endIdx)),this._contents}get length(){return this.endIdx-this.startIdx}coverageWith(...t){return et.coverage(...t,this)}collapsedLeft(){return new et(this.sourceString,this.startIdx,this.startIdx)}collapsedRight(){return new et(this.sourceString,this.endIdx,this.endIdx)}getLineAndColumn(){return Y(this.sourceString,this.startIdx)}getLineAndColumnMessage(){const t=[this.startIdx,this.endIdx];return X(this.sourceString,this.startIdx,t)}minus(t){if(this.sourceString!==t.sourceString)throw M();return this.startIdx===t.startIdx&&this.endIdx===t.endIdx?[]:this.startIdx<t.startIdx&&t.endIdx<this.endIdx?[new et(this.sourceString,this.startIdx,t.startIdx),new et(this.sourceString,t.endIdx,this.endIdx)]:this.startIdx<t.endIdx&&t.endIdx<this.endIdx?[new et(this.sourceString,t.endIdx,this.endIdx)]:this.startIdx<t.startIdx&&t.startIdx<this.endIdx?[new et(this.sourceString,this.startIdx,t.startIdx)]:[this]}relativeTo(t){if(this.sourceString!==t.sourceString)throw M();return r(this.startIdx>=t.startIdx&&this.endIdx<=t.endIdx,"other interval does not cover this one"),new et(this.sourceString,this.startIdx-t.startIdx,this.endIdx-t.startIdx)}trimmed(){const{contents:t}=this,e=this.startIdx+t.match(/^\s*/)[0].length,r=this.endIdx-t.match(/\s*$/)[0].length;return new et(this.sourceString,e,r)}subInterval(t,e){const r=this.startIdx+t;return new et(this.sourceString,r,r+e)}}et.coverage=function(t,...e){let{startIdx:r,endIdx:n}=t;for(const i of e){if(i.sourceString!==t.sourceString)throw M();r=Math.min(r,i.startIdx),n=Math.max(n,i.endIdx)}return new et(t.sourceString,r,n)};class rt{constructor(t){this.source=t,this.pos=0,this.examinedLength=0}atEnd(){const t=this.pos>=this.source.length;return this.examinedLength=Math.max(this.examinedLength,this.pos+1),t}next(){const t=this.source[this.pos++];return this.examinedLength=Math.max(this.examinedLength,this.pos),t}nextCharCode(){const t=this.next();return t&&t.charCodeAt(0)}nextCodePoint(){const t=this.source.slice(this.pos++).codePointAt(0);return t>65535&&(this.pos+=1),this.examinedLength=Math.max(this.examinedLength,this.pos),t}matchString(t,e){let r;if(e){for(r=0;r<t.length;r++){const e=this.next(),n=t[r];if(null==e||e.toUpperCase()!==n.toUpperCase())return!1}return!0}for(r=0;r<t.length;r++)if(this.next()!==t[r])return!1;return!0}sourceSlice(t,e){return this.source.slice(t,e)}interval(t,e){return new et(this.source,t,e||this.pos)}}class nt{constructor(t,e,r,i,s,o,a){this.matcher=t,this.input=e,this.startExpr=r,this._cst=i,this._cstOffset=s,this._rightmostFailurePosition=o,this._rightmostFailures=a,this.failed()&&(n(this,"message",(function(){const t="Expected "+this.getExpectedText();return X(this.input,this.getRightmostFailurePosition())+t})),n(this,"shortMessage",(function(){const t="expected "+this.getExpectedText(),e=Y(this.input,this.getRightmostFailurePosition());return"Line "+e.lineNum+", col "+e.colNum+": "+t})))}succeeded(){return!!this._cst}failed(){return!this.succeeded()}getRightmostFailurePosition(){return this._rightmostFailurePosition}getRightmostFailures(){if(!this._rightmostFailures){this.matcher.setInput(this.input);const t=this.matcher._match(this.startExpr,{tracing:!1,positionToRecordFailures:this.getRightmostFailurePosition()});this._rightmostFailures=t.getRightmostFailures()}return this._rightmostFailures}toString(){return this.succeeded()?"[match succeeded]":"[match failed at position "+this.getRightmostFailurePosition()+"]"}getExpectedText(){if(this.succeeded())throw new Error("cannot get expected text of a successful MatchResult");const t=new h;let e=this.getRightmostFailures();e=e.filter((t=>!t.isFluffy()));for(let r=0;r<e.length;r++)r>0&&(r===e.length-1?t.append(e.length>2?", or ":" or "):t.append(", ")),t.append(e[r].toString());return t.contents()}getInterval(){const t=this.getRightmostFailurePosition();return new et(this.input,t,t)}}class it{constructor(){this.applicationMemoKeyStack=[],this.memo={},this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,this.currentLeftRecursion=void 0}isActive(t){return this.applicationMemoKeyStack.indexOf(t.toMemoKey())>=0}enter(t){this.applicationMemoKeyStack.push(t.toMemoKey())}exit(){this.applicationMemoKeyStack.pop()}startLeftRecursion(t,e){e.isLeftRecursion=!0,e.headApplication=t,e.nextLeftRecursion=this.currentLeftRecursion,this.currentLeftRecursion=e;const{applicationMemoKeyStack:r}=this,n=r.indexOf(t.toMemoKey())+1,i=r.slice(n);e.isInvolved=function(t){return i.indexOf(t)>=0},e.updateInvolvedApplicationMemoKeys=function(){for(let t=n;t<r.length;t++){const e=r[t];this.isInvolved(e)||i.push(e)}}}endLeftRecursion(){this.currentLeftRecursion=this.currentLeftRecursion.nextLeftRecursion}shouldUseMemoizedResult(t){if(!t.isLeftRecursion)return!0;const{applicationMemoKeyStack:e}=this;for(let r=0;r<e.length;r++){const n=e[r];if(t.isInvolved(n))return!1}return!0}memoize(t,e){return this.memo[t]=e,this.maxExaminedLength=Math.max(this.maxExaminedLength,e.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,e.rightmostFailureOffset),e}clearObsoleteEntries(t,e){if(t+this.maxExaminedLength<=e)return;const{memo:r}=this;this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,Object.keys(r).forEach((n=>{const i=r[n];t+i.examinedLength>e?delete r[n]:(this.maxExaminedLength=Math.max(this.maxExaminedLength,i.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,i.rightmostFailureOffset))}))}}const st="⋅",ot="␉",at="␊",ut="␍",ct={succeeded:1,isRootNode:2,isImplicitSpaces:4,isMemoized:8,isHeadOfLeftRecursion:16,terminatesLR:32};function lt(t){return"string"==typeof t?t.replace(/ /g,st).replace(/\t/g,ot).replace(/\n/g,at).replace(/\r/g,ut):String(t)}class pt{constructor(t,e,r,n,i,s,o){this.input=t,this.pos=this.pos1=e,this.pos2=r,this.source=new et(t,e,r),this.expr=n,this.bindings=s,this.children=o||[],this.terminatingLREntry=null,this._flags=i?ct.succeeded:0}get displayString(){return this.expr.toDisplayString()}clone(){return this.cloneWithExpr(this.expr)}cloneWithExpr(t){const e=new pt(this.input,this.pos,this.pos2,t,this.succeeded,this.bindings,this.children);return e.isHeadOfLeftRecursion=this.isHeadOfLeftRecursion,e.isImplicitSpaces=this.isImplicitSpaces,e.isMemoized=this.isMemoized,e.isRootNode=this.isRootNode,e.terminatesLR=this.terminatesLR,e.terminatingLREntry=this.terminatingLREntry,e}recordLRTermination(t,e){this.terminatingLREntry=new pt(this.input,this.pos,this.pos2,this.expr,!1,[e],[t]),this.terminatingLREntry.terminatesLR=!0}walk(t,e){let r=t;function n(t,i,s){let o=!0;r.enter&&r.enter.call(e,t,i,s)===pt.prototype.SKIP&&(o=!1),o&&(t.children.forEach((e=>{n(e,t,s+1)})),r.exit&&r.exit.call(e,t,i,s))}"function"==typeof r&&(r={enter:r}),this.isRootNode?this.children.forEach((t=>{n(t,null,0)})):n(this,null,0)}toString(){const t=new h;return this.walk(((e,r,n)=>{if(!e)return this.SKIP;if("Alt"!==e.expr.constructor.name){if(t.append(function(t,e,r){const n=lt(t.slice(e,e+r));return n.length<r?n+o(" ",r-n.length).join(""):n}(e.input,e.pos,10)+o(" ",2*n+1).join("")),t.append((e.succeeded?"✓":"✗")+" "+e.displayString),e.isHeadOfLeftRecursion&&t.append(" (LR)"),e.succeeded){const r=lt(e.source.contents);t.append(" ⇒  "),t.append("string"==typeof r?'"'+r+'"':r)}t.append("\n")}})),t.contents()}}let ht,mt;pt.prototype.SKIP={},Object.keys(ct).forEach((t=>{const e=ct[t];Object.defineProperty(pt.prototype,t,{get(){return 0!=(this._flags&e)},set(t){t?this._flags|=e:this._flags&=~e}})})),I.prototype.allowsSkippingPrecedingSpace=e("allowsSkippingPrecedingSpace"),y.allowsSkippingPrecedingSpace=x.allowsSkippingPrecedingSpace=k.prototype.allowsSkippingPrecedingSpace=S.prototype.allowsSkippingPrecedingSpace=b.prototype.allowsSkippingPrecedingSpace=D.prototype.allowsSkippingPrecedingSpace=function(){return!0},w.prototype.allowsSkippingPrecedingSpace=L.prototype.allowsSkippingPrecedingSpace=T.prototype.allowsSkippingPrecedingSpace=C.prototype.allowsSkippingPrecedingSpace=E.prototype.allowsSkippingPrecedingSpace=_.prototype.allowsSkippingPrecedingSpace=O.prototype.allowsSkippingPrecedingSpace=function(){return!1},Z((t=>{ht=t})),I.prototype.assertAllApplicationsAreValid=function(t,e){mt=0,this._assertAllApplicationsAreValid(t,e)},I.prototype._assertAllApplicationsAreValid=e("_assertAllApplicationsAreValid"),y._assertAllApplicationsAreValid=x._assertAllApplicationsAreValid=S.prototype._assertAllApplicationsAreValid=b.prototype._assertAllApplicationsAreValid=_.prototype._assertAllApplicationsAreValid=D.prototype._assertAllApplicationsAreValid=function(t,e){},T.prototype._assertAllApplicationsAreValid=function(t,e){mt++,this.expr._assertAllApplicationsAreValid(t,e),mt--},w.prototype._assertAllApplicationsAreValid=function(t,e){for(let r=0;r<this.terms.length;r++)this.terms[r]._assertAllApplicationsAreValid(t,e)},O.prototype._assertAllApplicationsAreValid=function(t,e){for(let r=0;r<this.factors.length;r++)this.factors[r]._assertAllApplicationsAreValid(t,e)},L.prototype._assertAllApplicationsAreValid=E.prototype._assertAllApplicationsAreValid=C.prototype._assertAllApplicationsAreValid=function(t,e){this.expr._assertAllApplicationsAreValid(t,e)},k.prototype._assertAllApplicationsAreValid=function(t,e,r=!1){const n=e.rules[this.ruleName],i=c(t)&&0===mt;if(!n)throw G(this.ruleName,e.name,this.source);if(!r&&c(this.ruleName)&&!i)throw function(t,e){return j("Cannot apply syntactic rule "+t+" from here (inside a lexical context)",e.source)}(this.ruleName,this);const s=this.args.length,o=n.formals.length;if(s!==o)throw function(t,e,r,n){return j("Wrong number of arguments for rule "+t+" (expected "+e+", got "+r+")",n)}(this.ruleName,o,s,this.source);const a=ht&&n===ht.rules.applySyntactic;if(ht&&n===ht.rules.caseInsensitive&&!(this.args[0]instanceof S))throw z('a Terminal (e.g. "abc")',this.args[0]);if(a){const t=this.args[0];if(!(t instanceof k))throw z("a syntactic rule application",t);if(!c(t.ruleName))throw function(t){const{ruleName:e}=t;return j(`applySyntactic is for syntactic rules, but '${e}' is a lexical rule. `+$,t.source)}(t);if(i)throw j("applySyntactic is not required here (in a syntactic context)",this.source)}this.args.forEach((r=>{if(r._assertAllApplicationsAreValid(t,e,a),1!==r.getArity())throw function(t,e){return j("Invalid parameter to rule "+t+": "+e+" has arity "+e.getArity()+", but parameter expressions must have arity 1",e.source)}(this.ruleName,r)}))},I.prototype.assertChoicesHaveUniformArity=e("assertChoicesHaveUniformArity"),y.assertChoicesHaveUniformArity=x.assertChoicesHaveUniformArity=S.prototype.assertChoicesHaveUniformArity=b.prototype.assertChoicesHaveUniformArity=_.prototype.assertChoicesHaveUniformArity=T.prototype.assertChoicesHaveUniformArity=D.prototype.assertChoicesHaveUniformArity=function(t){},w.prototype.assertChoicesHaveUniformArity=function(t){if(0===this.terms.length)return;const e=this.terms[0].getArity();for(let r=0;r<this.terms.length;r++){const n=this.terms[r];n.assertChoicesHaveUniformArity();const i=n.getArity();if(e!==i)throw H(t,e,i,n)}},A.prototype.assertChoicesHaveUniformArity=function(t){const e=this.terms[0].getArity(),r=this.terms[1].getArity();if(e!==r)throw H(t,r,e,this.terms[0])},O.prototype.assertChoicesHaveUniformArity=function(t){for(let e=0;e<this.factors.length;e++)this.factors[e].assertChoicesHaveUniformArity(t)},L.prototype.assertChoicesHaveUniformArity=function(t){this.expr.assertChoicesHaveUniformArity(t)},E.prototype.assertChoicesHaveUniformArity=function(t){},C.prototype.assertChoicesHaveUniformArity=function(t){this.expr.assertChoicesHaveUniformArity(t)},k.prototype.assertChoicesHaveUniformArity=function(t){},I.prototype.assertIteratedExprsAreNotNullable=e("assertIteratedExprsAreNotNullable"),y.assertIteratedExprsAreNotNullable=x.assertIteratedExprsAreNotNullable=S.prototype.assertIteratedExprsAreNotNullable=b.prototype.assertIteratedExprsAreNotNullable=_.prototype.assertIteratedExprsAreNotNullable=D.prototype.assertIteratedExprsAreNotNullable=function(t){},w.prototype.assertIteratedExprsAreNotNullable=function(t){for(let e=0;e<this.terms.length;e++)this.terms[e].assertIteratedExprsAreNotNullable(t)},O.prototype.assertIteratedExprsAreNotNullable=function(t){for(let e=0;e<this.factors.length;e++)this.factors[e].assertIteratedExprsAreNotNullable(t)},L.prototype.assertIteratedExprsAreNotNullable=function(t){if(this.expr.assertIteratedExprsAreNotNullable(t),this.expr.isNullable(t))throw K(this,[])},P.prototype.assertIteratedExprsAreNotNullable=E.prototype.assertIteratedExprsAreNotNullable=C.prototype.assertIteratedExprsAreNotNullable=T.prototype.assertIteratedExprsAreNotNullable=function(t){this.expr.assertIteratedExprsAreNotNullable(t)},k.prototype.assertIteratedExprsAreNotNullable=function(t){this.args.forEach((e=>{e.assertIteratedExprsAreNotNullable(t)}))};class dt{constructor(t){this.matchLength=t}get ctorName(){throw new Error("subclass responsibility")}numChildren(){return this.children?this.children.length:0}childAt(t){if(this.children)return this.children[t]}indexOfChild(t){return this.children.indexOf(t)}hasChildren(){return this.numChildren()>0}hasNoChildren(){return!this.hasChildren()}onlyChild(){if(1!==this.numChildren())throw new Error("cannot get only child of a node of type "+this.ctorName+" (it has "+this.numChildren()+" children)");return this.firstChild()}firstChild(){if(this.hasNoChildren())throw new Error("cannot get first child of a "+this.ctorName+" node, which has no children");return this.childAt(0)}lastChild(){if(this.hasNoChildren())throw new Error("cannot get last child of a "+this.ctorName+" node, which has no children");return this.childAt(this.numChildren()-1)}childBefore(t){const e=this.indexOfChild(t);if(e<0)throw new Error("Node.childBefore() called w/ an argument that is not a child");if(0===e)throw new Error("cannot get child before first child");return this.childAt(e-1)}childAfter(t){const e=this.indexOfChild(t);if(e<0)throw new Error("Node.childAfter() called w/ an argument that is not a child");if(e===this.numChildren()-1)throw new Error("cannot get child after last child");return this.childAt(e+1)}isTerminal(){return!1}isNonterminal(){return!1}isIteration(){return!1}isOptional(){return!1}}class ft extends dt{get ctorName(){return"_terminal"}isTerminal(){return!0}get primitiveValue(){throw new Error("The `primitiveValue` property was removed in Ohm v17.")}}class gt extends dt{constructor(t,e,r,n){super(n),this.ruleName=t,this.children=e,this.childOffsets=r}get ctorName(){return this.ruleName}isNonterminal(){return!0}isLexical(){return l(this.ctorName)}isSyntactic(){return c(this.ctorName)}}class vt extends dt{constructor(t,e,r,n){super(r),this.children=t,this.childOffsets=e,this.optional=n}get ctorName(){return"_iter"}isIteration(){return!0}isOptional(){return this.optional}}function It(t,e){const r={};if(t.source&&e){const n=t.source.relativeTo(e);r.sourceInterval=[n.startIdx,n.endIdx]}return r}function yt(t){return/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(t)}function xt(t){const e=Object.create(null);t.forEach((t=>{e[t]=(e[t]||0)+1})),Object.keys(e).forEach((r=>{if(e[r]<=1)return;let n=1;t.forEach(((e,i)=>{e===r&&(t[i]=e+"_"+n++)}))}))}I.prototype.eval=e("eval"),y.eval=function(t){const{inputStream:e}=t,r=e.pos,n=e.nextCodePoint();return void 0!==n?(t.pushBinding(new ft(String.fromCodePoint(n).length),r),!0):(t.processFailure(r,this),!1)},x.eval=function(t){const{inputStream:e}=t,r=e.pos;return e.atEnd()?(t.pushBinding(new ft(0),r),!0):(t.processFailure(r,this),!1)},S.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos;return e.matchString(this.obj)?(t.pushBinding(new ft(this.obj.length),r),!0):(t.processFailure(r,this),!1)},b.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos,n=this.matchCodePoint?e.nextCodePoint():e.nextCharCode();return void 0!==n&&this.from.codePointAt(0)<=n&&n<=this.to.codePointAt(0)?(t.pushBinding(new ft(String.fromCodePoint(n).length),r),!0):(t.processFailure(r,this),!1)},_.prototype.eval=function(t){return t.eval(t.currentApplication().args[this.index])},T.prototype.eval=function(t){t.enterLexifiedContext();const e=t.eval(this.expr);return t.exitLexifiedContext(),e},w.prototype.eval=function(t){for(let e=0;e<this.terms.length;e++)if(t.eval(this.terms[e]))return!0;return!1},O.prototype.eval=function(t){for(let e=0;e<this.factors.length;e++){const r=this.factors[e];if(!t.eval(r))return!1}return!0},L.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos,n=this.getArity(),i=[],s=[];for(;i.length<n;)i.push([]),s.push([]);let o,a=0,u=r;for(;a<this.maxNumMatches&&t.eval(this.expr);){if(e.pos===u)throw K(this,t._applicationStack);u=e.pos,a++;const r=t._bindings.splice(t._bindings.length-n,n),c=t._bindingOffsets.splice(t._bindingOffsets.length-n,n);for(o=0;o<r.length;o++)i[o].push(r[o]),s[o].push(c[o])}if(a<this.minNumMatches)return!1;let c=t.posToOffset(r),l=0;if(a>0){const t=i[n-1],e=s[n-1],r=e[e.length-1]+t[t.length-1].matchLength;c=s[0][0],l=r-c}const p=this instanceof P;for(o=0;o<i.length;o++)t._bindings.push(new vt(i[o],s[o],l,p)),t._bindingOffsets.push(c);return!0},E.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos;t.pushFailuresInfo();const n=t.eval(this.expr);return t.popFailuresInfo(),n?(t.processFailure(r,this),!1):(e.pos=r,!0)},C.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos;return!!t.eval(this.expr)&&(e.pos=r,!0)},k.prototype.eval=function(t){const e=t.currentApplication(),r=e?e.args:[],n=this.substituteParams(r),i=t.getCurrentPosInfo();if(i.isActive(n))return n.handleCycle(t);const s=n.toMemoKey(),o=i.memo[s];if(o&&i.shouldUseMemoizedResult(o)){if(t.hasNecessaryInfo(o))return t.useMemoizedResult(t.inputStream.pos,o);delete i.memo[s]}return n.reallyEval(t)},k.prototype.handleCycle=function(t){const e=t.getCurrentPosInfo(),{currentLeftRecursion:r}=e,n=this.toMemoKey();let i=e.memo[n];return r&&r.headApplication.toMemoKey()===n?i.updateInvolvedApplicationMemoKeys():i||(i=e.memoize(n,{matchLength:0,examinedLength:0,value:!1,rightmostFailureOffset:-1}),e.startLeftRecursion(this,i)),t.useMemoizedResult(t.inputStream.pos,i)},k.prototype.reallyEval=function(t){const{inputStream:e}=t,n=e.pos,i=t.getCurrentPosInfo(),s=t.grammar.rules[this.ruleName],{body:o}=s,{description:a}=s;t.enterApplication(i,this),a&&t.pushFailuresInfo();const u=e.examinedLength;e.examinedLength=0;let c=this.evalOnce(o,t);const l=i.currentLeftRecursion,p=this.toMemoKey(),h=l&&l.headApplication.toMemoKey()===p;let m;t.doNotMemoize?t.doNotMemoize=!1:h?(c=this.growSeedResult(o,t,n,l,c),i.endLeftRecursion(),m=l,m.examinedLength=e.examinedLength-n,m.rightmostFailureOffset=t._getRightmostFailureOffset(),i.memoize(p,m)):l&&l.isInvolved(p)||(m=i.memoize(p,{matchLength:e.pos-n,examinedLength:e.examinedLength-n,value:c,failuresAtRightmostPosition:t.cloneRecordedFailures(),rightmostFailureOffset:t._getRightmostFailureOffset()}));const d=!!c;if(a&&(t.popFailuresInfo(),d||t.processFailure(n,this),m&&(m.failuresAtRightmostPosition=t.cloneRecordedFailures())),t.isTracing()&&m){const e=t.getTraceEntry(n,this,d,d?[c]:[]);h&&(r(null!=e.terminatingLREntry||!d),e.isHeadOfLeftRecursion=!0),m.traceEntry=e}return e.examinedLength=Math.max(e.examinedLength,u),t.exitApplication(i,c),d},k.prototype.evalOnce=function(t,e){const{inputStream:r}=e,n=r.pos;if(e.eval(t)){const i=t.getArity(),s=e._bindings.splice(e._bindings.length-i,i),o=e._bindingOffsets.splice(e._bindingOffsets.length-i,i),a=r.pos-n;return new gt(this.ruleName,s,o,a)}return!1},k.prototype.growSeedResult=function(t,e,r,n,i){if(!i)return!1;const{inputStream:s}=e;for(;;){if(n.matchLength=s.pos-r,n.value=i,n.failuresAtRightmostPosition=e.cloneRecordedFailures(),e.isTracing()){const t=e.trace[e.trace.length-1];n.traceEntry=new pt(e.input,r,s.pos,this,!0,[i],[t.clone()])}if(s.pos=r,i=this.evalOnce(t,e),s.pos-r<=n.matchLength)break;e.isTracing()&&e.trace.splice(-2,1)}return e.isTracing()&&n.traceEntry.recordLRTermination(e.trace.pop(),i),s.pos=r+n.matchLength,n.value},D.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos,n=e.next();return n&&this.pattern.test(n)?(t.pushBinding(new ft(n.length),r),!0):(t.processFailure(r,this),!1)},I.prototype.getArity=e("getArity"),y.getArity=x.getArity=S.prototype.getArity=b.prototype.getArity=_.prototype.getArity=k.prototype.getArity=D.prototype.getArity=function(){return 1},w.prototype.getArity=function(){return 0===this.terms.length?0:this.terms[0].getArity()},O.prototype.getArity=function(){let t=0;for(let e=0;e<this.factors.length;e++)t+=this.factors[e].getArity();return t},L.prototype.getArity=function(){return this.expr.getArity()},E.prototype.getArity=function(){return 0},C.prototype.getArity=T.prototype.getArity=function(){return this.expr.getArity()},I.prototype.outputRecipe=e("outputRecipe"),y.outputRecipe=function(t,e){return["any",It(this,e)]},x.outputRecipe=function(t,e){return["end",It(this,e)]},S.prototype.outputRecipe=function(t,e){return["terminal",It(this,e),this.obj]},b.prototype.outputRecipe=function(t,e){return["range",It(this,e),this.from,this.to]},_.prototype.outputRecipe=function(t,e){return["param",It(this,e),this.index]},w.prototype.outputRecipe=function(t,e){return["alt",It(this,e)].concat(this.terms.map((r=>r.outputRecipe(t,e))))},A.prototype.outputRecipe=function(t,e){return this.terms[0].outputRecipe(t,e)},N.prototype.outputRecipe=function(t,e){const r=this.terms.slice(0,this.expansionPos),n=this.terms.slice(this.expansionPos+1);return["splice",It(this,e),r.map((r=>r.outputRecipe(t,e))),n.map((r=>r.outputRecipe(t,e)))]},O.prototype.outputRecipe=function(t,e){return["seq",It(this,e)].concat(this.factors.map((r=>r.outputRecipe(t,e))))},R.prototype.outputRecipe=F.prototype.outputRecipe=P.prototype.outputRecipe=E.prototype.outputRecipe=C.prototype.outputRecipe=T.prototype.outputRecipe=function(t,e){return[this.constructor.name.toLowerCase(),It(this,e),this.expr.outputRecipe(t,e)]},k.prototype.outputRecipe=function(t,e){return["app",It(this,e),this.ruleName,this.args.map((r=>r.outputRecipe(t,e)))]},D.prototype.outputRecipe=function(t,e){return["unicodeChar",It(this,e),this.category]},I.prototype.introduceParams=e("introduceParams"),y.introduceParams=x.introduceParams=S.prototype.introduceParams=b.prototype.introduceParams=_.prototype.introduceParams=D.prototype.introduceParams=function(t){return this},w.prototype.introduceParams=function(t){return this.terms.forEach(((e,r,n)=>{n[r]=e.introduceParams(t)})),this},O.prototype.introduceParams=function(t){return this.factors.forEach(((e,r,n)=>{n[r]=e.introduceParams(t)})),this},L.prototype.introduceParams=E.prototype.introduceParams=C.prototype.introduceParams=T.prototype.introduceParams=function(t){return this.expr=this.expr.introduceParams(t),this},k.prototype.introduceParams=function(t){const e=t.indexOf(this.ruleName);if(e>=0){if(this.args.length>0)throw new Error("Parameterized rules cannot be passed as arguments to another rule.");return new _(e).withSource(this.source)}return this.args.forEach(((e,r,n)=>{n[r]=e.introduceParams(t)})),this},I.prototype.isNullable=function(t){return this._isNullable(t,Object.create(null))},I.prototype._isNullable=e("_isNullable"),y._isNullable=b.prototype._isNullable=_.prototype._isNullable=F.prototype._isNullable=D.prototype._isNullable=function(t,e){return!1},x._isNullable=function(t,e){return!0},S.prototype._isNullable=function(t,e){return"string"==typeof this.obj&&""===this.obj},w.prototype._isNullable=function(t,e){return 0===this.terms.length||this.terms.some((r=>r._isNullable(t,e)))},O.prototype._isNullable=function(t,e){return this.factors.every((r=>r._isNullable(t,e)))},R.prototype._isNullable=P.prototype._isNullable=E.prototype._isNullable=C.prototype._isNullable=function(t,e){return!0},T.prototype._isNullable=function(t,e){return this.expr._isNullable(t,e)},k.prototype._isNullable=function(t,e){const r=this.toMemoKey();if(!Object.prototype.hasOwnProperty.call(e,r)){const{body:n}=t.rules[this.ruleName],i=n.substituteParams(this.args);e[r]=!1,e[r]=i._isNullable(t,e)}return e[r]},I.prototype.substituteParams=e("substituteParams"),y.substituteParams=x.substituteParams=S.prototype.substituteParams=b.prototype.substituteParams=D.prototype.substituteParams=function(t){return this},_.prototype.substituteParams=function(t){return t[this.index]},w.prototype.substituteParams=function(t){return new w(this.terms.map((e=>e.substituteParams(t))))},O.prototype.substituteParams=function(t){return new O(this.factors.map((e=>e.substituteParams(t))))},L.prototype.substituteParams=E.prototype.substituteParams=C.prototype.substituteParams=T.prototype.substituteParams=function(t){return new this.constructor(this.expr.substituteParams(t))},k.prototype.substituteParams=function(t){if(0===this.args.length)return this;{const e=this.args.map((e=>e.substituteParams(t)));return new k(this.ruleName,e)}},I.prototype.toArgumentNameList=e("toArgumentNameList"),y.toArgumentNameList=function(t,e){return["any"]},x.toArgumentNameList=function(t,e){return["end"]},S.prototype.toArgumentNameList=function(t,e){return"string"==typeof this.obj&&/^[_a-zA-Z0-9]+$/.test(this.obj)?["_"+this.obj]:["$"+t]},b.prototype.toArgumentNameList=function(t,e){let r=this.from+"_to_"+this.to;return yt(r)||(r="_"+r),yt(r)||(r="$"+t),[r]},w.prototype.toArgumentNameList=function(t,e){const r=this.terms.map((e=>e.toArgumentNameList(t,!0))),n=[],i=r[0].length;for(let t=0;t<i;t++){const e=[];for(let n=0;n<this.terms.length;n++)e.push(r[n][t]);const i=u(e);n.push(i.join("_or_"))}return e||xt(n),n},O.prototype.toArgumentNameList=function(t,e){let r=[];return this.factors.forEach((e=>{const n=e.toArgumentNameList(t,!0);r=r.concat(n),t+=n.length})),e||xt(r),r},L.prototype.toArgumentNameList=function(t,e){const r=this.expr.toArgumentNameList(t,e).map((t=>"s"===t[t.length-1]?t+"es":t+"s"));return e||xt(r),r},P.prototype.toArgumentNameList=function(t,e){return this.expr.toArgumentNameList(t,e).map((t=>"opt"+t[0].toUpperCase()+t.slice(1)))},E.prototype.toArgumentNameList=function(t,e){return[]},C.prototype.toArgumentNameList=T.prototype.toArgumentNameList=function(t,e){return this.expr.toArgumentNameList(t,e)},k.prototype.toArgumentNameList=function(t,e){return[this.ruleName]},D.prototype.toArgumentNameList=function(t,e){return["$"+t]},_.prototype.toArgumentNameList=function(t,e){return["param"+this.index]},I.prototype.toDisplayString=e("toDisplayString"),w.prototype.toDisplayString=O.prototype.toDisplayString=function(){return this.source?this.source.trimmed().contents:"["+this.constructor.name+"]"},y.toDisplayString=x.toDisplayString=L.prototype.toDisplayString=E.prototype.toDisplayString=C.prototype.toDisplayString=T.prototype.toDisplayString=S.prototype.toDisplayString=b.prototype.toDisplayString=_.prototype.toDisplayString=function(){return this.toString()},k.prototype.toDisplayString=function(){if(this.args.length>0){const t=this.args.map((t=>t.toDisplayString()));return this.ruleName+"<"+t.join(",")+">"}return this.ruleName},D.prototype.toDisplayString=function(){return"Unicode ["+this.category+"] character"};class St{constructor(t,e,r){if(!function(t){return"description"===t||"string"===t||"code"===t}(r))throw new Error("invalid Failure type: "+r);this.pexpr=t,this.text=e,this.type=r,this.fluffy=!1}getPExpr(){return this.pexpr}getText(){return this.text}getType(){return this.type}isDescription(){return"description"===this.type}isStringTerminal(){return"string"===this.type}isCode(){return"code"===this.type}isFluffy(){return this.fluffy}makeFluffy(){this.fluffy=!0}clearFluffy(){this.fluffy=!1}subsumes(t){return this.getText()===t.getText()&&this.type===t.type&&(!this.isFluffy()||this.isFluffy()&&t.isFluffy())}toString(){return"string"===this.type?JSON.stringify(this.getText()):this.getText()}clone(){const t=new St(this.pexpr,this.text,this.type);return this.isFluffy()&&t.makeFluffy(),t}toKey(){return this.toString()+"#"+this.type}}I.prototype.toFailure=e("toFailure"),y.toFailure=function(t){return new St(this,"any object","description")},x.toFailure=function(t){return new St(this,"end of input","description")},S.prototype.toFailure=function(t){return new St(this,this.obj,"string")},b.prototype.toFailure=function(t){return new St(this,JSON.stringify(this.from)+".."+JSON.stringify(this.to),"code")},E.prototype.toFailure=function(t){const e=this.expr===y?"nothing":"not "+this.expr.toFailure(t);return new St(this,e,"description")},C.prototype.toFailure=function(t){return this.expr.toFailure(t)},k.prototype.toFailure=function(t){let{description:e}=t.rules[this.ruleName];if(!e){e=(/^[aeiouAEIOU]/.test(this.ruleName)?"an":"a")+" "+this.ruleName}return new St(this,e,"description")},D.prototype.toFailure=function(t){return new St(this,"a Unicode ["+this.category+"] character","description")},w.prototype.toFailure=function(t){const e="("+this.terms.map((e=>e.toFailure(t))).join(" or ")+")";return new St(this,e,"description")},O.prototype.toFailure=function(t){const e="("+this.factors.map((e=>e.toFailure(t))).join(" ")+")";return new St(this,e,"description")},L.prototype.toFailure=function(t){const e="("+this.expr.toFailure(t)+this.operator+")";return new St(this,e,"description")},I.prototype.toString=e("toString"),y.toString=function(){return"any"},x.toString=function(){return"end"},S.prototype.toString=function(){return JSON.stringify(this.obj)},b.prototype.toString=function(){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)},_.prototype.toString=function(){return"$"+this.index},T.prototype.toString=function(){return"#("+this.expr.toString()+")"},w.prototype.toString=function(){return 1===this.terms.length?this.terms[0].toString():"("+this.terms.map((t=>t.toString())).join(" | ")+")"},O.prototype.toString=function(){return 1===this.factors.length?this.factors[0].toString():"("+this.factors.map((t=>t.toString())).join(" ")+")"},L.prototype.toString=function(){return this.expr+this.operator},E.prototype.toString=function(){return"~"+this.expr},C.prototype.toString=function(){return"&"+this.expr},k.prototype.toString=function(){if(this.args.length>0){const t=this.args.map((t=>t.toString()));return this.ruleName+"<"+t.join(",")+">"}return this.ruleName},D.prototype.toString=function(){return"\\p{"+this.category+"}"};class bt extends I{constructor(t){super(),this.obj=t}_getString(t){const e=t.currentApplication().args[this.obj.index];return r(e instanceof S,"expected a Terminal expression"),e.obj}allowsSkippingPrecedingSpace(){return!0}eval(t){const{inputStream:e}=t,r=e.pos,n=this._getString(t);return e.matchString(n,!0)?(t.pushBinding(new ft(n.length),r),!0):(t.processFailure(r,this),!1)}getArity(){return 1}substituteParams(t){return new bt(this.obj.substituteParams(t))}toDisplayString(){return this.obj.toDisplayString()+" (case-insensitive)"}toFailure(t){return new St(this,this.obj.toFailure(t)+" (case-insensitive)","description")}_isNullable(t,e){return this.obj._isNullable(t,e)}}var _t=Object.freeze({__proto__:null,CaseInsensitiveTerminal:bt,PExpr:I,any:y,end:x,Terminal:S,Range:b,Param:_,Alt:w,Extend:A,Splice:N,Seq:O,Iter:L,Star:R,Plus:F,Opt:P,Not:E,Lookahead:C,Lex:T,Apply:k,UnicodeChar:D});let wt;Z((t=>{wt=t.rules.applySyntactic.body}));const At=new k("spaces");class Nt{constructor(t,e,r){this.matcher=t,this.startExpr=e,this.grammar=t.grammar,this.input=t.getInput(),this.inputStream=new rt(this.input),this.memoTable=t._memoTable,this.userData=void 0,this.doNotMemoize=!1,this._bindings=[],this._bindingOffsets=[],this._applicationStack=[],this._posStack=[0],this.inLexifiedContextStack=[!1],this.rightmostFailurePosition=-1,this._rightmostFailurePositionStack=[],this._recordedFailuresStack=[],void 0!==r&&(this.positionToRecordFailures=r,this.recordedFailures=Object.create(null))}posToOffset(t){return t-this._posStack[this._posStack.length-1]}enterApplication(t,e){this._posStack.push(this.inputStream.pos),this._applicationStack.push(e),this.inLexifiedContextStack.push(!1),t.enter(e),this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this.rightmostFailurePosition=-1}exitApplication(t,e){const r=this._posStack.pop();this._applicationStack.pop(),this.inLexifiedContextStack.pop(),t.exit(),this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,this._rightmostFailurePositionStack.pop()),e&&this.pushBinding(e,r)}enterLexifiedContext(){this.inLexifiedContextStack.push(!0)}exitLexifiedContext(){this.inLexifiedContextStack.pop()}currentApplication(){return this._applicationStack[this._applicationStack.length-1]}inSyntacticContext(){const t=this.currentApplication();return t?t.isSyntactic()&&!this.inLexifiedContext():this.startExpr.factors[0].isSyntactic()}inLexifiedContext(){return this.inLexifiedContextStack[this.inLexifiedContextStack.length-1]}skipSpaces(){return this.pushFailuresInfo(),this.eval(At),this.popBinding(),this.popFailuresInfo(),this.inputStream.pos}skipSpacesIfInSyntacticContext(){return this.inSyntacticContext()?this.skipSpaces():this.inputStream.pos}maybeSkipSpacesBefore(t){return t.allowsSkippingPrecedingSpace()&&t!==At?this.skipSpacesIfInSyntacticContext():this.inputStream.pos}pushBinding(t,e){this._bindings.push(t),this._bindingOffsets.push(this.posToOffset(e))}popBinding(){this._bindings.pop(),this._bindingOffsets.pop()}numBindings(){return this._bindings.length}truncateBindings(t){for(;this._bindings.length>t;)this.popBinding()}getCurrentPosInfo(){return this.getPosInfo(this.inputStream.pos)}getPosInfo(t){let e=this.memoTable[t];return e||(e=this.memoTable[t]=new it),e}processFailure(t,e){if(this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,t),this.recordedFailures&&t===this.positionToRecordFailures){const t=this.currentApplication();t&&(e=e.substituteParams(t.args)),this.recordFailure(e.toFailure(this.grammar),!1)}}recordFailure(t,e){const r=t.toKey();this.recordedFailures[r]?this.recordedFailures[r].isFluffy()&&!t.isFluffy()&&this.recordedFailures[r].clearFluffy():this.recordedFailures[r]=e?t.clone():t}recordFailures(t,e){Object.keys(t).forEach((r=>{this.recordFailure(t[r],e)}))}cloneRecordedFailures(){if(!this.recordedFailures)return;const t=Object.create(null);return Object.keys(this.recordedFailures).forEach((e=>{t[e]=this.recordedFailures[e].clone()})),t}getRightmostFailurePosition(){return this.rightmostFailurePosition}_getRightmostFailureOffset(){return this.rightmostFailurePosition>=0?this.posToOffset(this.rightmostFailurePosition):-1}getMemoizedTraceEntry(t,e){const r=this.memoTable[t];if(r&&e instanceof k){const t=r.memo[e.toMemoKey()];if(t&&t.traceEntry){const r=t.traceEntry.cloneWithExpr(e);return r.isMemoized=!0,r}}return null}getTraceEntry(t,e,r,n){if(e instanceof k){const t=this.currentApplication(),r=t?t.args:[];e=e.substituteParams(r)}return this.getMemoizedTraceEntry(t,e)||new pt(this.input,t,this.inputStream.pos,e,r,n,this.trace)}isTracing(){return!!this.trace}hasNecessaryInfo(t){return!(this.trace&&!t.traceEntry)&&(!this.recordedFailures||this.inputStream.pos+t.rightmostFailureOffset!==this.positionToRecordFailures||!!t.failuresAtRightmostPosition)}useMemoizedResult(t,e){this.trace&&this.trace.push(e.traceEntry);const r=this.inputStream.pos+e.rightmostFailureOffset;return this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,r),this.recordedFailures&&this.positionToRecordFailures===r&&e.failuresAtRightmostPosition&&this.recordFailures(e.failuresAtRightmostPosition,!0),this.inputStream.examinedLength=Math.max(this.inputStream.examinedLength,e.examinedLength+t),!!e.value&&(this.inputStream.pos+=e.matchLength,this.pushBinding(e.value,t),!0)}eval(t){const{inputStream:e}=this,r=this._bindings.length,n=this.userData;let i;this.recordedFailures&&(i=this.recordedFailures,this.recordedFailures=Object.create(null));const s=e.pos,o=this.maybeSkipSpacesBefore(t);let a;this.trace&&(a=this.trace,this.trace=[]);const u=t.eval(this);if(this.trace){const e=this._bindings.slice(r),n=this.getTraceEntry(o,t,u,e);n.isImplicitSpaces=t===At,n.isRootNode=t===this.startExpr,a.push(n),this.trace=a}return u?this.recordedFailures&&e.pos===this.positionToRecordFailures&&Object.keys(this.recordedFailures).forEach((t=>{this.recordedFailures[t].makeFluffy()})):(e.pos=s,this.truncateBindings(r),this.userData=n),this.recordedFailures&&this.recordFailures(i,!1),t===wt&&this.skipSpaces(),u}getMatchResult(){let t;this.grammar._setUpMatchState(this),this.eval(this.startExpr),this.recordedFailures&&(t=Object.keys(this.recordedFailures).map((t=>this.recordedFailures[t])));const e=this._bindings[0];return e&&(e.grammar=this.grammar),new nt(this.matcher,this.input,this.startExpr,e,this._bindingOffsets[0],this.rightmostFailurePosition,t)}getTrace(){this.trace=[];const t=this.getMatchResult(),e=this.trace[this.trace.length-1];return e.result=t,e}pushFailuresInfo(){this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this._recordedFailuresStack.push(this.recordedFailures)}popFailuresInfo(){this.rightmostFailurePosition=this._rightmostFailurePositionStack.pop(),this.recordedFailures=this._recordedFailuresStack.pop()}}class Ot{constructor(t){this.grammar=t,this._memoTable=[],this._input="",this._isMemoTableStale=!1}_resetMemoTable(){this._memoTable=[],this._isMemoTableStale=!1}getInput(){return this._input}setInput(t){return this._input!==t&&this.replaceInputRange(0,this._input.length,t),this}replaceInputRange(t,e,r){const n=this._input,i=this._memoTable;if(t<0||t>n.length||e<0||e>n.length||t>e)throw new Error("Invalid indices: "+t+" and "+e);this._input=n.slice(0,t)+r+n.slice(e),this._input!==n&&i.length>0&&(this._isMemoTableStale=!0);const s=i.slice(e);i.length=t;for(let t=0;t<r.length;t++)i.push(void 0);for(const t of s)i.push(t);for(let e=0;e<t;e++){const r=i[e];r&&r.clearObsoleteEntries(e,t)}return this}match(t,e={incremental:!0}){return this._match(this._getStartExpr(t),{incremental:e.incremental,tracing:!1})}trace(t,e={incremental:!0}){return this._match(this._getStartExpr(t),{incremental:e.incremental,tracing:!0})}_match(t,e={}){const r={tracing:!1,incremental:!0,positionToRecordFailures:void 0,...e};if(r.incremental){if(this._isMemoTableStale&&!this.grammar.supportsIncrementalParsing)throw function(t){return j(`Grammar '${t.name}' does not support incremental parsing`)}(this.grammar)}else this._resetMemoTable();const n=new Nt(this,t,r.positionToRecordFailures);return r.tracing?n.getTrace():n.getMatchResult()}_getStartExpr(t){const e=t||this.grammar.defaultStartRule;if(!e)throw new Error("Missing start rule argument -- the grammar has no default start rule.");const r=this.grammar.parseApplication(e);return new O([r,x])}}const Lt=[],Rt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);class Ft{constructor(t,e,n){this._node=t,this.source=e,this._baseInterval=n,t.isNonterminal()&&r(e===n),this._childWrappers=[]}_forgetMemoizedResultFor(t){delete this._node[this._semantics.attributeKeys[t]],this.children.forEach((e=>{e._forgetMemoizedResultFor(t)}))}child(t){if(!(0<=t&&t<this._node.numChildren()))return;let e=this._childWrappers[t];if(!e){const r=this._node.childAt(t),n=this._node.childOffsets[t],i=this._baseInterval.subInterval(n,r.matchLength),s=r.isNonterminal()?i:this._baseInterval;e=this._childWrappers[t]=this._semantics.wrap(r,i,s)}return e}_children(){for(let t=0;t<this._node.numChildren();t++)this.child(t);return this._childWrappers}isIteration(){return this._node.isIteration()}isTerminal(){return this._node.isTerminal()}isNonterminal(){return this._node.isNonterminal()}isSyntactic(){return this.isNonterminal()&&this._node.isSyntactic()}isLexical(){return this.isNonterminal()&&this._node.isLexical()}isOptional(){return this._node.isOptional()}iteration(t){const e=t||[],r=e.map((t=>t._node)),n=new vt(r,[],-1,!1),i=this._semantics.wrap(n,null,null);return i._childWrappers=e,i}get children(){return this._children()}get ctorName(){return this._node.ctorName}get numChildren(){return this._node.numChildren()}get sourceString(){return this.source.contents}}class Pt{constructor(t,e){const r=this;if(this.grammar=t,this.checkedActionDicts=!1,this.Wrapper=class extends(e?e.Wrapper:Ft){constructor(t,e,n){super(t,e,n),r.checkActionDictsIfHaventAlready(),this._semantics=r}toString(){return"[semantics wrapper for "+r.grammar.name+"]"}},this.super=e,e){if(!t.equals(this.super.grammar)&&!t._inheritsFrom(this.super.grammar))throw new Error("Cannot extend a semantics for grammar '"+this.super.grammar.name+"' for use with grammar '"+t.name+"' (not a sub-grammar)");this.operations=Object.create(this.super.operations),this.attributes=Object.create(this.super.attributes),this.attributeKeys=Object.create(null);for(const t in this.attributes)Object.defineProperty(this.attributeKeys,t,{value:tt(t)})}else this.operations=Object.create(null),this.attributes=Object.create(null),this.attributeKeys=Object.create(null)}toString(){return"[semantics for "+this.grammar.name+"]"}checkActionDictsIfHaventAlready(){this.checkedActionDicts||(this.checkActionDicts(),this.checkedActionDicts=!0)}checkActionDicts(){let t;for(t in this.operations)this.operations[t].checkActionDict(this.grammar);for(t in this.attributes)this.attributes[t].checkActionDict(this.grammar)}toRecipe(t){function e(t){return t.super!==Pt.BuiltInSemantics._getSemantics()}let r="(function(g) {\n";if(e(this)){r+="  var semantics = "+this.super.toRecipe(!0)+"(g";const t=this.super.grammar;let e=this.grammar;for(;e!==t;)r+=".superGrammar",e=e.superGrammar;r+=");\n",r+="  return g.extendSemantics(semantics)"}else r+="  return g.createSemantics()";return["Operation","Attribute"].forEach((t=>{const n=this[t.toLowerCase()+"s"];Object.keys(n).forEach((i=>{const{actionDict:s,formals:o,builtInDefault:a}=n[i];let u,c=i;o.length>0&&(c+="("+o.join(", ")+")"),u=e(this)&&this.super[t.toLowerCase()+"s"][i]?"extend"+t:"add"+t,r+="\n    ."+u+"("+JSON.stringify(c)+", {";const l=[];Object.keys(s).forEach((t=>{if(s[t]!==a){let e=s[t].toString().trim();e=e.replace(/^.*\(/,"function("),l.push("\n      "+JSON.stringify(t)+": "+e)}})),r+=l.join(",")+"\n    })"}))})),r+=";\n  })",t||(r="(function() {\n  var grammar = this.fromRecipe("+this.grammar.toRecipe()+");\n  var semantics = "+r+"(grammar);\n  return semantics;\n});\n"),r}addOperationOrAttribute(t,e,r){const n=t+"s",i=Et(e,t),{name:s}=i,{formals:o}=i;this.assertNewName(s,t);const a=function(t,e,r){return function(...n){const i=(this._semantics.operations[e]||this._semantics.attributes[e]).formals.map((t=>this.args[t]));if(this.isIteration()||1!==n.length)throw function(t,e,r,n){let i=n.slice(0,-1).map((t=>{const e="  "+t[0].name+" > "+t[1];return 3===t.length?e+" for '"+t[2]+"'":e})).join("\n");i+="\n  "+e+" > "+t;let s="";"_iter"===t&&(s=["\nNOTE: as of Ohm v16, there is no default action for iteration nodes — see ","  https://ohmjs.org/d/dsa for details."].join("\n"));const o=j([`Missing semantic action for '${t}' in ${r} '${e}'.${s}`,"Action stack (most recent call last):",i].join("\n"));return o.name="missingSemanticAction",o}(this.ctorName,e,t,Lt);return r.apply(n[0],i)}}(t,s,l),u={_default:a};Object.keys(r).forEach((t=>{u[t]=r[t]}));const c="operation"===t?new Ct(s,o,u,a):new Tt(s,u,a);function l(...e){const r=this._semantics[n][s];if(arguments.length!==r.formals.length)throw new Error("Invalid number of arguments passed to "+s+" "+t+" (expected "+r.formals.length+", got "+arguments.length+")");const i=Object.create(null);for(const[t,n]of Object.entries(e)){i[r.formals[t]]=n}const o=this.args;this.args=i;const a=r.execute(this._semantics,this);return this.args=o,a}c.checkActionDict(this.grammar),this[n][s]=c,"operation"===t?(this.Wrapper.prototype[s]=l,this.Wrapper.prototype[s].toString=function(){return"["+s+" operation]"}):(Object.defineProperty(this.Wrapper.prototype,s,{get:l,configurable:!0}),Object.defineProperty(this.attributeKeys,s,{value:tt(s)}))}extendOperationOrAttribute(t,e,r){const n=t+"s";if(Et(e,"attribute"),!this.super||!(e in this.super[n]))throw new Error("Cannot extend "+t+" '"+e+"': did not inherit an "+t+" with that name");if(Rt(this[n],e))throw new Error("Cannot extend "+t+" '"+e+"' again");const i=this[n][e].formals,s=this[n][e].actionDict,o=Object.create(s);Object.keys(r).forEach((t=>{o[t]=r[t]})),this[n][e]="operation"===t?new Ct(e,i,o):new Tt(e,o),this[n][e].checkActionDict(this.grammar)}assertNewName(t,e){if(Rt(Ft.prototype,t))throw new Error("Cannot add "+e+" '"+t+"': that's a reserved name");if(t in this.operations)throw new Error("Cannot add "+e+" '"+t+"': an operation with that name already exists");if(t in this.attributes)throw new Error("Cannot add "+e+" '"+t+"': an attribute with that name already exists")}wrap(t,e,r){const n=r||e;return t instanceof this.Wrapper?t:new this.Wrapper(t,e,n)}}function Et(t,e){if(!Pt.prototypeGrammar)return r(-1===t.indexOf("(")),{name:t,formals:[]};const n=Pt.prototypeGrammar.match(t,"operation"===e?"OperationSignature":"AttributeSignature");if(n.failed())throw new Error(n.message);return Pt.prototypeGrammarSemantics(n).parse()}Pt.createSemantics=function(t,e){const r=new Pt(t,void 0!==e?e:Pt.BuiltInSemantics._getSemantics()),n=function(e){if(!(e instanceof nt))throw new TypeError("Semantics expected a MatchResult, but got "+f(e));if(e.failed())throw new TypeError("cannot apply Semantics to "+e.toString());const n=e._cst;if(n.grammar!==t)throw new Error("Cannot use a MatchResult from grammar '"+n.grammar.name+"' with a semantics for '"+t.name+"'");const i=new rt(e.input);return r.wrap(n,i.interval(e._cstOffset,e.input.length))};return n.addOperation=function(t,e){return r.addOperationOrAttribute("operation",t,e),n},n.extendOperation=function(t,e){return r.extendOperationOrAttribute("operation",t,e),n},n.addAttribute=function(t,e){return r.addOperationOrAttribute("attribute",t,e),n},n.extendAttribute=function(t,e){return r.extendOperationOrAttribute("attribute",t,e),n},n._getActionDict=function(e){const n=r.operations[e]||r.attributes[e];if(!n)throw new Error('"'+e+'" is not a valid operation or attribute name in this semantics for "'+t.name+'"');return n.actionDict},n._remove=function(t){let e;return t in r.operations?(e=r.operations[t],delete r.operations[t]):t in r.attributes&&(e=r.attributes[t],delete r.attributes[t]),delete r.Wrapper.prototype[t],e},n.getOperationNames=function(){return Object.keys(r.operations)},n.getAttributeNames=function(){return Object.keys(r.attributes)},n.getGrammar=function(){return r.grammar},n.toRecipe=function(t){return r.toRecipe(t)},n.toString=r.toString.bind(r),n._getSemantics=function(){return r},n};class Ct{constructor(t,e,r,n){this.name=t,this.formals=e,this.actionDict=r,this.builtInDefault=n}checkActionDict(t){t._checkTopDownActionDict(this.typeName,this.name,this.actionDict)}execute(t,e){try{const{ctorName:t}=e._node;let r=this.actionDict[t];return r?(Lt.push([this,t]),r.apply(e,e._children())):e.isNonterminal()&&(r=this.actionDict._nonterminal,r)?(Lt.push([this,"_nonterminal",t]),r.apply(e,e._children())):(Lt.push([this,"default action",t]),this.actionDict._default.apply(e,e._children()))}finally{Lt.pop()}}}Ct.prototype.typeName="operation";class Tt extends Ct{constructor(t,e,r){super(t,[],e,r)}execute(t,e){const r=e._node,n=t.attributeKeys[this.name];return Rt(r,n)||(r[n]=Ct.prototype.execute.call(this,t,e)),r[n]}}Tt.prototype.typeName="attribute";const kt=["_iter","_terminal","_nonterminal","_default"];function Dt(t){return Object.keys(t.rules).sort().map((e=>t.rules[e]))}let jt,Mt;class Gt{constructor(t,e,r,n){if(this.name=t,this.superGrammar=e,this.rules=r,n){if(!(n in r))throw new Error("Invalid start rule: '"+n+"' is not a rule in grammar '"+t+"'");this.defaultStartRule=n}this._matchStateInitializer=void 0,this.supportsIncrementalParsing=!0}matcher(){return new Ot(this)}isBuiltIn(){return this===Gt.ProtoBuiltInRules||this===Gt.BuiltInRules}equals(t){if(this===t)return!0;if(null==t||this.name!==t.name||this.defaultStartRule!==t.defaultStartRule||this.superGrammar!==t.superGrammar&&!this.superGrammar.equals(t.superGrammar))return!1;const e=Dt(this),r=Dt(t);return e.length===r.length&&e.every(((t,e)=>t.description===r[e].description&&t.formals.join(",")===r[e].formals.join(",")&&t.body.toString()===r[e].body.toString()))}match(t,e){const r=this.matcher();return r.replaceInputRange(0,0,t),r.match(e)}trace(t,e){const r=this.matcher();return r.replaceInputRange(0,0,t),r.trace(e)}createSemantics(){return Pt.createSemantics(this)}extendSemantics(t){return Pt.createSemantics(this,t._getSemantics())}_checkTopDownActionDict(t,e,r){const n=[];for(const t in r){const e=r[t];if(!kt.includes(t)&&!(t in this.rules)){n.push(`'${t}' is not a valid semantic action for '${this.name}'`);continue}if("function"!=typeof e){n.push(`'${t}' must be a function in an action dictionary for '${this.name}'`);continue}const i=e.length,s=this._topDownActionArity(t);if(i!==s){let e;e="_iter"===t||"_nonterminal"===t?`it should use a rest parameter, e.g. \`${t}(...children) {}\`. NOTE: this is new in Ohm v16 — see https://ohmjs.org/d/ati for details.`:`expected ${s}, got ${i}`,n.push(`Semantic action '${t}' has the wrong arity: ${e}`)}}if(n.length>0){const r=n.map((t=>"- "+t)),i=new Error([`Found errors in the action dictionary of the '${e}' ${t}:`,...r].join("\n"));throw i.problems=n,i}}_topDownActionArity(t){return kt.includes(t)?0:this.rules[t].body.getArity()}_inheritsFrom(t){let e=this.superGrammar;for(;e;){if(e.equals(t,!0))return!0;e=e.superGrammar}return!1}toRecipe(t=undefined){const e={};this.source&&(e.source=this.source.contents);let r=null;this.defaultStartRule&&(r=this.defaultStartRule);const n={};Object.keys(this.rules).forEach((t=>{const e=this.rules[t],{body:r}=e,i=!this.superGrammar||!this.superGrammar.rules[t];let s;s=i?"define":r instanceof A?"extend":"override";const o={};if(e.source&&this.source){const t=e.source.relativeTo(this.source);o.sourceInterval=[t.startIdx,t.endIdx]}const a=i?e.description:null,u=r.outputRecipe(e.formals,this.source);n[t]=[s,o,a,e.formals,u]}));let i="null";t?i=t:this.superGrammar&&!this.superGrammar.isBuiltIn()&&(i=this.superGrammar.toRecipe());const s=[...["grammar",e,this.name].map(JSON.stringify),i,...[r,n].map(JSON.stringify)];return`[${s.join(",")}]`.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}toOperationActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}toAttributeActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}_toOperationOrAttributeActionDictionaryTemplate(){const t=new h;t.append("{");let e=!0;for(const r in this.rules){const{body:n}=this.rules[r];e?e=!1:t.append(","),t.append("\n"),t.append("  "),this.addSemanticActionTemplate(r,n,t)}return t.append("\n}"),t.contents()}addSemanticActionTemplate(t,e,r){r.append(t),r.append(": function(");const n=this._topDownActionArity(t);r.append(o("_",n).join(", ")),r.append(") {\n"),r.append("  }")}parseApplication(t){let e;if(-1===t.indexOf("<"))e=new k(t);else{const r=jt.match(t,"Base_application");e=Mt(r,{})}if(!(e.ruleName in this.rules))throw G(e.ruleName,this.name);const{formals:r}=this.rules[e.ruleName];if(r.length!==e.args.length){const{source:t}=this.rules[e.ruleName];throw q(e.ruleName,r.length,e.args.length,t)}return e}_setUpMatchState(t){this._matchStateInitializer&&this._matchStateInitializer(t)}}Gt.ProtoBuiltInRules=new Gt("ProtoBuiltInRules",void 0,{any:{body:y,formals:[],description:"any character",primitive:!0},end:{body:x,formals:[],description:"end of input",primitive:!0},caseInsensitive:{body:new bt(new _(0)),formals:["str"],primitive:!0},lower:{body:new D("Ll"),formals:[],description:"a lowercase letter",primitive:!0},upper:{body:new D("Lu"),formals:[],description:"an uppercase letter",primitive:!0},unicodeLtmo:{body:new D("Ltmo"),formals:[],description:"a Unicode character in Lt, Lm, or Lo",primitive:!0},spaces:{body:new R(new k("space")),formals:[]},space:{body:new b("\0"," "),formals:[],description:"a space"}}),Gt.initApplicationParser=function(t,e){jt=t,Mt=e};class Bt{constructor(t){this.name=t}sourceInterval(t,e){return this.source.subInterval(t,e-t)}ensureSuperGrammar(){return this.superGrammar||this.withSuperGrammar("BuiltInRules"===this.name?Gt.ProtoBuiltInRules:Gt.BuiltInRules),this.superGrammar}ensureSuperGrammarRuleForOverriding(t,e){const r=this.ensureSuperGrammar().rules[t];if(!r)throw n=t,i=this.superGrammar.name,j("Cannot override rule "+n+" because it is not declared in "+i,e);var n,i;return r}installOverriddenOrExtendedRule(t,e,r,n){const i=a(e);if(i.length>0)throw U(t,i,n);const s=this.ensureSuperGrammar().rules[t],o=s.formals,u=o?o.length:0;if(e.length!==u)throw q(t,u,e.length,n);return this.install(t,e,r,s.description,n)}install(t,e,r,n,i,s=!1){return this.rules[t]={body:r.introduceParams(e),formals:e,description:n,source:i,primitive:s},this}withSuperGrammar(t){if(this.superGrammar)throw new Error("the super grammar of a GrammarDecl cannot be set more than once");return this.superGrammar=t,this.rules=Object.create(t.rules),t.isBuiltIn()||(this.defaultStartRule=t.defaultStartRule),this}withDefaultStartRule(t){return this.defaultStartRule=t,this}withSource(t){return this.source=new rt(t).interval(0,t.length),this}build(){const t=new Gt(this.name,this.ensureSuperGrammar(),this.rules,this.defaultStartRule);t._matchStateInitializer=t.superGrammar._matchStateInitializer,t.supportsIncrementalParsing=t.superGrammar.supportsIncrementalParsing;const e=[];let r=!1;return Object.keys(t.rules).forEach((n=>{const{body:i}=t.rules[n];try{i.assertChoicesHaveUniformArity(n)}catch(t){e.push(t)}try{i.assertAllApplicationsAreValid(n,t)}catch(t){e.push(t),r=!0}})),r||Object.keys(t.rules).forEach((r=>{const{body:n}=t.rules[r];try{n.assertIteratedExprsAreNotNullable(t,[])}catch(t){e.push(t)}})),e.length>0&&V(e),this.source&&(t.source=this.source),t}define(t,e,r,n,i,s){if(this.ensureSuperGrammar(),this.superGrammar.rules[t])throw B(t,this.name,this.superGrammar.name,i);if(this.rules[t])throw B(t,this.name,this.name,i);const o=a(e);if(o.length>0)throw U(t,o,i);return this.install(t,e,r,n,i,s)}override(t,e,r,n,i){return this.ensureSuperGrammarRuleForOverriding(t,i),this.installOverriddenOrExtendedRule(t,e,r,i),this}extend(t,e,r,n,i){if(!this.ensureSuperGrammar().rules[t])throw s=t,o=this.superGrammar.name,j("Cannot extend rule "+s+" because it is not declared in "+o,i);var s,o;const a=new A(this.superGrammar,t,r);return a.source=r.source,this.installOverriddenOrExtendedRule(t,e,a,i),this}}class qt{constructor(){this.currentDecl=null,this.currentRuleName=null}newGrammar(t){return new Bt(t)}grammar(t,e,r,n,i){const s=new Bt(e);return r&&s.withSuperGrammar(r instanceof Gt?r:this.fromRecipe(r)),n&&s.withDefaultStartRule(n),t&&t.source&&s.withSource(t.source),this.currentDecl=s,Object.keys(i).forEach((t=>{this.currentRuleName=t;const e=i[t],r=e[0],n=e[1],o=e[2],a=e[3],u=this.fromRecipe(e[4]);let c;s.source&&n&&n.sourceInterval&&(c=s.source.subInterval(n.sourceInterval[0],n.sourceInterval[1]-n.sourceInterval[0])),s[r](t,a,u,o,c)})),this.currentRuleName=this.currentDecl=null,s.build()}terminal(t){return new S(t)}range(t,e){return new b(t,e)}param(t){return new _(t)}alt(...t){let e=[];for(let r of t)r instanceof I||(r=this.fromRecipe(r)),r instanceof w?e=e.concat(r.terms):e.push(r);return 1===e.length?e[0]:new w(e)}seq(...t){let e=[];for(let r of t)r instanceof I||(r=this.fromRecipe(r)),r instanceof O?e=e.concat(r.factors):e.push(r);return 1===e.length?e[0]:new O(e)}star(t){return t instanceof I||(t=this.fromRecipe(t)),new R(t)}plus(t){return t instanceof I||(t=this.fromRecipe(t)),new F(t)}opt(t){return t instanceof I||(t=this.fromRecipe(t)),new P(t)}not(t){return t instanceof I||(t=this.fromRecipe(t)),new E(t)}lookahead(t){return t instanceof I||(t=this.fromRecipe(t)),new C(t)}lex(t){return t instanceof I||(t=this.fromRecipe(t)),new T(t)}app(t,e){return e&&e.length>0&&(e=e.map((function(t){return t instanceof I?t:this.fromRecipe(t)}),this)),new k(t,e)}splice(t,e){return new N(this.currentDecl.superGrammar,this.currentRuleName,t.map((t=>this.fromRecipe(t))),e.map((t=>this.fromRecipe(t))))}fromRecipe(t){const e="grammar"===t[0]?t.slice(1):t.slice(2),r=this[t[0]](...e),n=t[1];return n&&n.sourceInterval&&this.currentDecl&&r.withSource(this.currentDecl.sourceInterval(...n.sourceInterval)),r}}function Ut(t){return"function"==typeof t?t.call(new qt):("string"==typeof t&&(t=JSON.parse(t)),(new qt).fromRecipe(t))}var $t=Ut(["grammar",{source:'BuiltInRules {\n\n  alnum  (an alpha-numeric character)\n    = letter\n    | digit\n\n  letter  (a letter)\n    = lower\n    | upper\n    | unicodeLtmo\n\n  digit  (a digit)\n    = "0".."9"\n\n  hexDigit  (a hexadecimal digit)\n    = digit\n    | "a".."f"\n    | "A".."F"\n\n  ListOf<elem, sep>\n    = NonemptyListOf<elem, sep>\n    | EmptyListOf<elem, sep>\n\n  NonemptyListOf<elem, sep>\n    = elem (sep elem)*\n\n  EmptyListOf<elem, sep>\n    = /* nothing */\n\n  listOf<elem, sep>\n    = nonemptyListOf<elem, sep>\n    | emptyListOf<elem, sep>\n\n  nonemptyListOf<elem, sep>\n    = elem (sep elem)*\n\n  emptyListOf<elem, sep>\n    = /* nothing */\n\n  // Allows a syntactic rule application within a lexical context.\n  applySyntactic<app> = app\n}'},"BuiltInRules",null,null,{alnum:["define",{sourceInterval:[18,78]},"an alpha-numeric character",[],["alt",{sourceInterval:[60,78]},["app",{sourceInterval:[60,66]},"letter",[]],["app",{sourceInterval:[73,78]},"digit",[]]]],letter:["define",{sourceInterval:[82,142]},"a letter",[],["alt",{sourceInterval:[107,142]},["app",{sourceInterval:[107,112]},"lower",[]],["app",{sourceInterval:[119,124]},"upper",[]],["app",{sourceInterval:[131,142]},"unicodeLtmo",[]]]],digit:["define",{sourceInterval:[146,177]},"a digit",[],["range",{sourceInterval:[169,177]},"0","9"]],hexDigit:["define",{sourceInterval:[181,254]},"a hexadecimal digit",[],["alt",{sourceInterval:[219,254]},["app",{sourceInterval:[219,224]},"digit",[]],["range",{sourceInterval:[231,239]},"a","f"],["range",{sourceInterval:[246,254]},"A","F"]]],ListOf:["define",{sourceInterval:[258,336]},null,["elem","sep"],["alt",{sourceInterval:[282,336]},["app",{sourceInterval:[282,307]},"NonemptyListOf",[["param",{sourceInterval:[297,301]},0],["param",{sourceInterval:[303,306]},1]]],["app",{sourceInterval:[314,336]},"EmptyListOf",[["param",{sourceInterval:[326,330]},0],["param",{sourceInterval:[332,335]},1]]]]],NonemptyListOf:["define",{sourceInterval:[340,388]},null,["elem","sep"],["seq",{sourceInterval:[372,388]},["param",{sourceInterval:[372,376]},0],["star",{sourceInterval:[377,388]},["seq",{sourceInterval:[378,386]},["param",{sourceInterval:[378,381]},1],["param",{sourceInterval:[382,386]},0]]]]],EmptyListOf:["define",{sourceInterval:[392,434]},null,["elem","sep"],["seq",{sourceInterval:[438,438]}]],listOf:["define",{sourceInterval:[438,516]},null,["elem","sep"],["alt",{sourceInterval:[462,516]},["app",{sourceInterval:[462,487]},"nonemptyListOf",[["param",{sourceInterval:[477,481]},0],["param",{sourceInterval:[483,486]},1]]],["app",{sourceInterval:[494,516]},"emptyListOf",[["param",{sourceInterval:[506,510]},0],["param",{sourceInterval:[512,515]},1]]]]],nonemptyListOf:["define",{sourceInterval:[520,568]},null,["elem","sep"],["seq",{sourceInterval:[552,568]},["param",{sourceInterval:[552,556]},0],["star",{sourceInterval:[557,568]},["seq",{sourceInterval:[558,566]},["param",{sourceInterval:[558,561]},1],["param",{sourceInterval:[562,566]},0]]]]],emptyListOf:["define",{sourceInterval:[572,682]},null,["elem","sep"],["seq",{sourceInterval:[685,685]}]],applySyntactic:["define",{sourceInterval:[685,710]},null,["app"],["param",{sourceInterval:[707,710]},0]]}]);Gt.BuiltInRules=$t,function(t){Q.forEach((e=>{e(t)})),Q=null}(Gt.BuiltInRules);var zt=Ut(["grammar",{source:'Ohm {\n\n  Grammars\n    = Grammar*\n\n  Grammar\n    = ident SuperGrammar? "{" Rule* "}"\n\n  SuperGrammar\n    = "<:" ident\n\n  Rule\n    = ident Formals? ruleDescr? "="  RuleBody  -- define\n    | ident Formals?            ":=" OverrideRuleBody  -- override\n    | ident Formals?            "+=" RuleBody  -- extend\n\n  RuleBody\n    = "|"? NonemptyListOf<TopLevelTerm, "|">\n\n  TopLevelTerm\n    = Seq caseName  -- inline\n    | Seq\n\n  OverrideRuleBody\n    = "|"? NonemptyListOf<OverrideTopLevelTerm, "|">\n\n  OverrideTopLevelTerm\n    = "..."  -- superSplice\n    | TopLevelTerm\n\n  Formals\n    = "<" ListOf<ident, ","> ">"\n\n  Params\n    = "<" ListOf<Seq, ","> ">"\n\n  Alt\n    = NonemptyListOf<Seq, "|">\n\n  Seq\n    = Iter*\n\n  Iter\n    = Pred "*"  -- star\n    | Pred "+"  -- plus\n    | Pred "?"  -- opt\n    | Pred\n\n  Pred\n    = "~" Lex  -- not\n    | "&" Lex  -- lookahead\n    | Lex\n\n  Lex\n    = "#" Base  -- lex\n    | Base\n\n  Base\n    = ident Params? ~(ruleDescr? "=" | ":=" | "+=")  -- application\n    | oneCharTerminal ".." oneCharTerminal           -- range\n    | terminal                                       -- terminal\n    | "(" Alt ")"                                    -- paren\n\n  ruleDescr  (a rule description)\n    = "(" ruleDescrText ")"\n\n  ruleDescrText\n    = (~")" any)*\n\n  caseName\n    = "--" (~"\\n" space)* name (~"\\n" space)* ("\\n" | &"}")\n\n  name  (a name)\n    = nameFirst nameRest*\n\n  nameFirst\n    = "_"\n    | letter\n\n  nameRest\n    = "_"\n    | alnum\n\n  ident  (an identifier)\n    = name\n\n  terminal\n    = "\\"" terminalChar* "\\""\n\n  oneCharTerminal\n    = "\\"" terminalChar "\\""\n\n  terminalChar\n    = escapeChar\n      | ~"\\\\" ~"\\"" ~"\\n" "\\u{0}".."\\u{10FFFF}"\n\n  escapeChar  (an escape sequence)\n    = "\\\\\\\\"                                     -- backslash\n    | "\\\\\\""                                     -- doubleQuote\n    | "\\\\\\\'"                                     -- singleQuote\n    | "\\\\b"                                      -- backspace\n    | "\\\\n"                                      -- lineFeed\n    | "\\\\r"                                      -- carriageReturn\n    | "\\\\t"                                      -- tab\n    | "\\\\u{" hexDigit hexDigit? hexDigit?\n             hexDigit? hexDigit? hexDigit? "}"   -- unicodeCodePoint\n    | "\\\\u" hexDigit hexDigit hexDigit hexDigit  -- unicodeEscape\n    | "\\\\x" hexDigit hexDigit                    -- hexEscape\n\n  space\n   += comment\n\n  comment\n    = "//" (~"\\n" any)* &("\\n" | end)  -- singleLine\n    | "/*" (~"*/" any)* "*/"  -- multiLine\n\n  tokens = token*\n\n  token = caseName | comment | ident | operator | punctuation | terminal | any\n\n  operator = "<:" | "=" | ":=" | "+=" | "*" | "+" | "?" | "~" | "&"\n\n  punctuation = "<" | ">" | "," | "--"\n}'},"Ohm",null,"Grammars",{Grammars:["define",{sourceInterval:[9,32]},null,[],["star",{sourceInterval:[24,32]},["app",{sourceInterval:[24,31]},"Grammar",[]]]],Grammar:["define",{sourceInterval:[36,83]},null,[],["seq",{sourceInterval:[50,83]},["app",{sourceInterval:[50,55]},"ident",[]],["opt",{sourceInterval:[56,69]},["app",{sourceInterval:[56,68]},"SuperGrammar",[]]],["terminal",{sourceInterval:[70,73]},"{"],["star",{sourceInterval:[74,79]},["app",{sourceInterval:[74,78]},"Rule",[]]],["terminal",{sourceInterval:[80,83]},"}"]]],SuperGrammar:["define",{sourceInterval:[87,116]},null,[],["seq",{sourceInterval:[106,116]},["terminal",{sourceInterval:[106,110]},"<:"],["app",{sourceInterval:[111,116]},"ident",[]]]],Rule_define:["define",{sourceInterval:[131,181]},null,[],["seq",{sourceInterval:[131,170]},["app",{sourceInterval:[131,136]},"ident",[]],["opt",{sourceInterval:[137,145]},["app",{sourceInterval:[137,144]},"Formals",[]]],["opt",{sourceInterval:[146,156]},["app",{sourceInterval:[146,155]},"ruleDescr",[]]],["terminal",{sourceInterval:[157,160]},"="],["app",{sourceInterval:[162,170]},"RuleBody",[]]]],Rule_override:["define",{sourceInterval:[188,248]},null,[],["seq",{sourceInterval:[188,235]},["app",{sourceInterval:[188,193]},"ident",[]],["opt",{sourceInterval:[194,202]},["app",{sourceInterval:[194,201]},"Formals",[]]],["terminal",{sourceInterval:[214,218]},":="],["app",{sourceInterval:[219,235]},"OverrideRuleBody",[]]]],Rule_extend:["define",{sourceInterval:[255,305]},null,[],["seq",{sourceInterval:[255,294]},["app",{sourceInterval:[255,260]},"ident",[]],["opt",{sourceInterval:[261,269]},["app",{sourceInterval:[261,268]},"Formals",[]]],["terminal",{sourceInterval:[281,285]},"+="],["app",{sourceInterval:[286,294]},"RuleBody",[]]]],Rule:["define",{sourceInterval:[120,305]},null,[],["alt",{sourceInterval:[131,305]},["app",{sourceInterval:[131,170]},"Rule_define",[]],["app",{sourceInterval:[188,235]},"Rule_override",[]],["app",{sourceInterval:[255,294]},"Rule_extend",[]]]],RuleBody:["define",{sourceInterval:[309,362]},null,[],["seq",{sourceInterval:[324,362]},["opt",{sourceInterval:[324,328]},["terminal",{sourceInterval:[324,327]},"|"]],["app",{sourceInterval:[329,362]},"NonemptyListOf",[["app",{sourceInterval:[344,356]},"TopLevelTerm",[]],["terminal",{sourceInterval:[358,361]},"|"]]]]],TopLevelTerm_inline:["define",{sourceInterval:[385,408]},null,[],["seq",{sourceInterval:[385,397]},["app",{sourceInterval:[385,388]},"Seq",[]],["app",{sourceInterval:[389,397]},"caseName",[]]]],TopLevelTerm:["define",{sourceInterval:[366,418]},null,[],["alt",{sourceInterval:[385,418]},["app",{sourceInterval:[385,397]},"TopLevelTerm_inline",[]],["app",{sourceInterval:[415,418]},"Seq",[]]]],OverrideRuleBody:["define",{sourceInterval:[422,491]},null,[],["seq",{sourceInterval:[445,491]},["opt",{sourceInterval:[445,449]},["terminal",{sourceInterval:[445,448]},"|"]],["app",{sourceInterval:[450,491]},"NonemptyListOf",[["app",{sourceInterval:[465,485]},"OverrideTopLevelTerm",[]],["terminal",{sourceInterval:[487,490]},"|"]]]]],OverrideTopLevelTerm_superSplice:["define",{sourceInterval:[522,543]},null,[],["terminal",{sourceInterval:[522,527]},"..."]],OverrideTopLevelTerm:["define",{sourceInterval:[495,562]},null,[],["alt",{sourceInterval:[522,562]},["app",{sourceInterval:[522,527]},"OverrideTopLevelTerm_superSplice",[]],["app",{sourceInterval:[550,562]},"TopLevelTerm",[]]]],Formals:["define",{sourceInterval:[566,606]},null,[],["seq",{sourceInterval:[580,606]},["terminal",{sourceInterval:[580,583]},"<"],["app",{sourceInterval:[584,602]},"ListOf",[["app",{sourceInterval:[591,596]},"ident",[]],["terminal",{sourceInterval:[598,601]},","]]],["terminal",{sourceInterval:[603,606]},">"]]],Params:["define",{sourceInterval:[610,647]},null,[],["seq",{sourceInterval:[623,647]},["terminal",{sourceInterval:[623,626]},"<"],["app",{sourceInterval:[627,643]},"ListOf",[["app",{sourceInterval:[634,637]},"Seq",[]],["terminal",{sourceInterval:[639,642]},","]]],["terminal",{sourceInterval:[644,647]},">"]]],Alt:["define",{sourceInterval:[651,685]},null,[],["app",{sourceInterval:[661,685]},"NonemptyListOf",[["app",{sourceInterval:[676,679]},"Seq",[]],["terminal",{sourceInterval:[681,684]},"|"]]]],Seq:["define",{sourceInterval:[689,704]},null,[],["star",{sourceInterval:[699,704]},["app",{sourceInterval:[699,703]},"Iter",[]]]],Iter_star:["define",{sourceInterval:[719,736]},null,[],["seq",{sourceInterval:[719,727]},["app",{sourceInterval:[719,723]},"Pred",[]],["terminal",{sourceInterval:[724,727]},"*"]]],Iter_plus:["define",{sourceInterval:[743,760]},null,[],["seq",{sourceInterval:[743,751]},["app",{sourceInterval:[743,747]},"Pred",[]],["terminal",{sourceInterval:[748,751]},"+"]]],Iter_opt:["define",{sourceInterval:[767,783]},null,[],["seq",{sourceInterval:[767,775]},["app",{sourceInterval:[767,771]},"Pred",[]],["terminal",{sourceInterval:[772,775]},"?"]]],Iter:["define",{sourceInterval:[708,794]},null,[],["alt",{sourceInterval:[719,794]},["app",{sourceInterval:[719,727]},"Iter_star",[]],["app",{sourceInterval:[743,751]},"Iter_plus",[]],["app",{sourceInterval:[767,775]},"Iter_opt",[]],["app",{sourceInterval:[790,794]},"Pred",[]]]],Pred_not:["define",{sourceInterval:[809,824]},null,[],["seq",{sourceInterval:[809,816]},["terminal",{sourceInterval:[809,812]},"~"],["app",{sourceInterval:[813,816]},"Lex",[]]]],Pred_lookahead:["define",{sourceInterval:[831,852]},null,[],["seq",{sourceInterval:[831,838]},["terminal",{sourceInterval:[831,834]},"&"],["app",{sourceInterval:[835,838]},"Lex",[]]]],Pred:["define",{sourceInterval:[798,862]},null,[],["alt",{sourceInterval:[809,862]},["app",{sourceInterval:[809,816]},"Pred_not",[]],["app",{sourceInterval:[831,838]},"Pred_lookahead",[]],["app",{sourceInterval:[859,862]},"Lex",[]]]],Lex_lex:["define",{sourceInterval:[876,892]},null,[],["seq",{sourceInterval:[876,884]},["terminal",{sourceInterval:[876,879]},"#"],["app",{sourceInterval:[880,884]},"Base",[]]]],Lex:["define",{sourceInterval:[866,903]},null,[],["alt",{sourceInterval:[876,903]},["app",{sourceInterval:[876,884]},"Lex_lex",[]],["app",{sourceInterval:[899,903]},"Base",[]]]],Base_application:["define",{sourceInterval:[918,979]},null,[],["seq",{sourceInterval:[918,963]},["app",{sourceInterval:[918,923]},"ident",[]],["opt",{sourceInterval:[924,931]},["app",{sourceInterval:[924,930]},"Params",[]]],["not",{sourceInterval:[932,963]},["alt",{sourceInterval:[934,962]},["seq",{sourceInterval:[934,948]},["opt",{sourceInterval:[934,944]},["app",{sourceInterval:[934,943]},"ruleDescr",[]]],["terminal",{sourceInterval:[945,948]},"="]],["terminal",{sourceInterval:[951,955]},":="],["terminal",{sourceInterval:[958,962]},"+="]]]]],Base_range:["define",{sourceInterval:[986,1041]},null,[],["seq",{sourceInterval:[986,1022]},["app",{sourceInterval:[986,1001]},"oneCharTerminal",[]],["terminal",{sourceInterval:[1002,1006]},".."],["app",{sourceInterval:[1007,1022]},"oneCharTerminal",[]]]],Base_terminal:["define",{sourceInterval:[1048,1106]},null,[],["app",{sourceInterval:[1048,1056]},"terminal",[]]],Base_paren:["define",{sourceInterval:[1113,1168]},null,[],["seq",{sourceInterval:[1113,1124]},["terminal",{sourceInterval:[1113,1116]},"("],["app",{sourceInterval:[1117,1120]},"Alt",[]],["terminal",{sourceInterval:[1121,1124]},")"]]],Base:["define",{sourceInterval:[907,1168]},null,[],["alt",{sourceInterval:[918,1168]},["app",{sourceInterval:[918,963]},"Base_application",[]],["app",{sourceInterval:[986,1022]},"Base_range",[]],["app",{sourceInterval:[1048,1056]},"Base_terminal",[]],["app",{sourceInterval:[1113,1124]},"Base_paren",[]]]],ruleDescr:["define",{sourceInterval:[1172,1231]},"a rule description",[],["seq",{sourceInterval:[1210,1231]},["terminal",{sourceInterval:[1210,1213]},"("],["app",{sourceInterval:[1214,1227]},"ruleDescrText",[]],["terminal",{sourceInterval:[1228,1231]},")"]]],ruleDescrText:["define",{sourceInterval:[1235,1266]},null,[],["star",{sourceInterval:[1255,1266]},["seq",{sourceInterval:[1256,1264]},["not",{sourceInterval:[1256,1260]},["terminal",{sourceInterval:[1257,1260]},")"]],["app",{sourceInterval:[1261,1264]},"any",[]]]]],caseName:["define",{sourceInterval:[1270,1338]},null,[],["seq",{sourceInterval:[1285,1338]},["terminal",{sourceInterval:[1285,1289]},"--"],["star",{sourceInterval:[1290,1304]},["seq",{sourceInterval:[1291,1302]},["not",{sourceInterval:[1291,1296]},["terminal",{sourceInterval:[1292,1296]},"\n"]],["app",{sourceInterval:[1297,1302]},"space",[]]]],["app",{sourceInterval:[1305,1309]},"name",[]],["star",{sourceInterval:[1310,1324]},["seq",{sourceInterval:[1311,1322]},["not",{sourceInterval:[1311,1316]},["terminal",{sourceInterval:[1312,1316]},"\n"]],["app",{sourceInterval:[1317,1322]},"space",[]]]],["alt",{sourceInterval:[1326,1337]},["terminal",{sourceInterval:[1326,1330]},"\n"],["lookahead",{sourceInterval:[1333,1337]},["terminal",{sourceInterval:[1334,1337]},"}"]]]]],name:["define",{sourceInterval:[1342,1382]},"a name",[],["seq",{sourceInterval:[1363,1382]},["app",{sourceInterval:[1363,1372]},"nameFirst",[]],["star",{sourceInterval:[1373,1382]},["app",{sourceInterval:[1373,1381]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[1386,1418]},null,[],["alt",{sourceInterval:[1402,1418]},["terminal",{sourceInterval:[1402,1405]},"_"],["app",{sourceInterval:[1412,1418]},"letter",[]]]],nameRest:["define",{sourceInterval:[1422,1452]},null,[],["alt",{sourceInterval:[1437,1452]},["terminal",{sourceInterval:[1437,1440]},"_"],["app",{sourceInterval:[1447,1452]},"alnum",[]]]],ident:["define",{sourceInterval:[1456,1489]},"an identifier",[],["app",{sourceInterval:[1485,1489]},"name",[]]],terminal:["define",{sourceInterval:[1493,1531]},null,[],["seq",{sourceInterval:[1508,1531]},["terminal",{sourceInterval:[1508,1512]},'"'],["star",{sourceInterval:[1513,1526]},["app",{sourceInterval:[1513,1525]},"terminalChar",[]]],["terminal",{sourceInterval:[1527,1531]},'"']]],oneCharTerminal:["define",{sourceInterval:[1535,1579]},null,[],["seq",{sourceInterval:[1557,1579]},["terminal",{sourceInterval:[1557,1561]},'"'],["app",{sourceInterval:[1562,1574]},"terminalChar",[]],["terminal",{sourceInterval:[1575,1579]},'"']]],terminalChar:["define",{sourceInterval:[1583,1660]},null,[],["alt",{sourceInterval:[1602,1660]},["app",{sourceInterval:[1602,1612]},"escapeChar",[]],["seq",{sourceInterval:[1621,1660]},["not",{sourceInterval:[1621,1626]},["terminal",{sourceInterval:[1622,1626]},"\\"]],["not",{sourceInterval:[1627,1632]},["terminal",{sourceInterval:[1628,1632]},'"']],["not",{sourceInterval:[1633,1638]},["terminal",{sourceInterval:[1634,1638]},"\n"]],["range",{sourceInterval:[1639,1660]},"\0","􏿿"]]]],escapeChar_backslash:["define",{sourceInterval:[1703,1758]},null,[],["terminal",{sourceInterval:[1703,1709]},"\\\\"]],escapeChar_doubleQuote:["define",{sourceInterval:[1765,1822]},null,[],["terminal",{sourceInterval:[1765,1771]},'\\"']],escapeChar_singleQuote:["define",{sourceInterval:[1829,1886]},null,[],["terminal",{sourceInterval:[1829,1835]},"\\'"]],escapeChar_backspace:["define",{sourceInterval:[1893,1948]},null,[],["terminal",{sourceInterval:[1893,1898]},"\\b"]],escapeChar_lineFeed:["define",{sourceInterval:[1955,2009]},null,[],["terminal",{sourceInterval:[1955,1960]},"\\n"]],escapeChar_carriageReturn:["define",{sourceInterval:[2016,2076]},null,[],["terminal",{sourceInterval:[2016,2021]},"\\r"]],escapeChar_tab:["define",{sourceInterval:[2083,2132]},null,[],["terminal",{sourceInterval:[2083,2088]},"\\t"]],escapeChar_unicodeCodePoint:["define",{sourceInterval:[2139,2243]},null,[],["seq",{sourceInterval:[2139,2221]},["terminal",{sourceInterval:[2139,2145]},"\\u{"],["app",{sourceInterval:[2146,2154]},"hexDigit",[]],["opt",{sourceInterval:[2155,2164]},["app",{sourceInterval:[2155,2163]},"hexDigit",[]]],["opt",{sourceInterval:[2165,2174]},["app",{sourceInterval:[2165,2173]},"hexDigit",[]]],["opt",{sourceInterval:[2188,2197]},["app",{sourceInterval:[2188,2196]},"hexDigit",[]]],["opt",{sourceInterval:[2198,2207]},["app",{sourceInterval:[2198,2206]},"hexDigit",[]]],["opt",{sourceInterval:[2208,2217]},["app",{sourceInterval:[2208,2216]},"hexDigit",[]]],["terminal",{sourceInterval:[2218,2221]},"}"]]],escapeChar_unicodeEscape:["define",{sourceInterval:[2250,2309]},null,[],["seq",{sourceInterval:[2250,2291]},["terminal",{sourceInterval:[2250,2255]},"\\u"],["app",{sourceInterval:[2256,2264]},"hexDigit",[]],["app",{sourceInterval:[2265,2273]},"hexDigit",[]],["app",{sourceInterval:[2274,2282]},"hexDigit",[]],["app",{sourceInterval:[2283,2291]},"hexDigit",[]]]],escapeChar_hexEscape:["define",{sourceInterval:[2316,2371]},null,[],["seq",{sourceInterval:[2316,2339]},["terminal",{sourceInterval:[2316,2321]},"\\x"],["app",{sourceInterval:[2322,2330]},"hexDigit",[]],["app",{sourceInterval:[2331,2339]},"hexDigit",[]]]],escapeChar:["define",{sourceInterval:[1664,2371]},"an escape sequence",[],["alt",{sourceInterval:[1703,2371]},["app",{sourceInterval:[1703,1709]},"escapeChar_backslash",[]],["app",{sourceInterval:[1765,1771]},"escapeChar_doubleQuote",[]],["app",{sourceInterval:[1829,1835]},"escapeChar_singleQuote",[]],["app",{sourceInterval:[1893,1898]},"escapeChar_backspace",[]],["app",{sourceInterval:[1955,1960]},"escapeChar_lineFeed",[]],["app",{sourceInterval:[2016,2021]},"escapeChar_carriageReturn",[]],["app",{sourceInterval:[2083,2088]},"escapeChar_tab",[]],["app",{sourceInterval:[2139,2221]},"escapeChar_unicodeCodePoint",[]],["app",{sourceInterval:[2250,2291]},"escapeChar_unicodeEscape",[]],["app",{sourceInterval:[2316,2339]},"escapeChar_hexEscape",[]]]],space:["extend",{sourceInterval:[2375,2394]},null,[],["app",{sourceInterval:[2387,2394]},"comment",[]]],comment_singleLine:["define",{sourceInterval:[2412,2458]},null,[],["seq",{sourceInterval:[2412,2443]},["terminal",{sourceInterval:[2412,2416]},"//"],["star",{sourceInterval:[2417,2429]},["seq",{sourceInterval:[2418,2427]},["not",{sourceInterval:[2418,2423]},["terminal",{sourceInterval:[2419,2423]},"\n"]],["app",{sourceInterval:[2424,2427]},"any",[]]]],["lookahead",{sourceInterval:[2430,2443]},["alt",{sourceInterval:[2432,2442]},["terminal",{sourceInterval:[2432,2436]},"\n"],["app",{sourceInterval:[2439,2442]},"end",[]]]]]],comment_multiLine:["define",{sourceInterval:[2465,2501]},null,[],["seq",{sourceInterval:[2465,2487]},["terminal",{sourceInterval:[2465,2469]},"/*"],["star",{sourceInterval:[2470,2482]},["seq",{sourceInterval:[2471,2480]},["not",{sourceInterval:[2471,2476]},["terminal",{sourceInterval:[2472,2476]},"*/"]],["app",{sourceInterval:[2477,2480]},"any",[]]]],["terminal",{sourceInterval:[2483,2487]},"*/"]]],comment:["define",{sourceInterval:[2398,2501]},null,[],["alt",{sourceInterval:[2412,2501]},["app",{sourceInterval:[2412,2443]},"comment_singleLine",[]],["app",{sourceInterval:[2465,2487]},"comment_multiLine",[]]]],tokens:["define",{sourceInterval:[2505,2520]},null,[],["star",{sourceInterval:[2514,2520]},["app",{sourceInterval:[2514,2519]},"token",[]]]],token:["define",{sourceInterval:[2524,2600]},null,[],["alt",{sourceInterval:[2532,2600]},["app",{sourceInterval:[2532,2540]},"caseName",[]],["app",{sourceInterval:[2543,2550]},"comment",[]],["app",{sourceInterval:[2553,2558]},"ident",[]],["app",{sourceInterval:[2561,2569]},"operator",[]],["app",{sourceInterval:[2572,2583]},"punctuation",[]],["app",{sourceInterval:[2586,2594]},"terminal",[]],["app",{sourceInterval:[2597,2600]},"any",[]]]],operator:["define",{sourceInterval:[2604,2669]},null,[],["alt",{sourceInterval:[2615,2669]},["terminal",{sourceInterval:[2615,2619]},"<:"],["terminal",{sourceInterval:[2622,2625]},"="],["terminal",{sourceInterval:[2628,2632]},":="],["terminal",{sourceInterval:[2635,2639]},"+="],["terminal",{sourceInterval:[2642,2645]},"*"],["terminal",{sourceInterval:[2648,2651]},"+"],["terminal",{sourceInterval:[2654,2657]},"?"],["terminal",{sourceInterval:[2660,2663]},"~"],["terminal",{sourceInterval:[2666,2669]},"&"]]],punctuation:["define",{sourceInterval:[2673,2709]},null,[],["alt",{sourceInterval:[2687,2709]},["terminal",{sourceInterval:[2687,2690]},"<"],["terminal",{sourceInterval:[2693,2696]},">"],["terminal",{sourceInterval:[2699,2702]},","],["terminal",{sourceInterval:[2705,2709]},"--"]]]}]);const Kt=Object.create(I.prototype);function Ht(t,e){for(const r in t)if(r===e)return!0;return!1}function Vt(t,e,n){const i=new qt;let s,o,a,u=!1;const c=(n||zt).createSemantics().addOperation("visit",{Grammars:t=>t.children.map((t=>t.visit())),Grammar(t,r,n,o,a){const u=t.visit();s=i.newGrammar(u),r.child(0)&&r.child(0).visit(),o.children.map((t=>t.visit()));const c=s.build();if(c.source=this.source.trimmed(),Ht(e,u))throw function(t,e){return j("Grammar "+t.name+" is already declared in this namespace")}(c);return e[u]=c,c},SuperGrammar(t,r){const n=r.visit();if("null"===n)s.withSuperGrammar(null);else{if(!e||!Ht(e,n))throw function(t,e,r){return j(e?`Grammar ${t} is not declared in namespace '${e}'`:"Undeclared grammar "+t,r)}(n,e,r.source);s.withSuperGrammar(e[n])}},Rule_define(t,e,r,n,i){o=t.visit(),a=e.children.map((t=>t.visit()))[0]||[],s.defaultStartRule||s.ensureSuperGrammar()===Gt.ProtoBuiltInRules||s.withDefaultStartRule(o);const u=i.visit(),c=r.children.map((t=>t.visit()))[0],l=this.source.trimmed();return s.define(o,a,u,c,l)},Rule_override(t,e,r,n){o=t.visit(),a=e.children.map((t=>t.visit()))[0]||[];const i=this.source.trimmed();s.ensureSuperGrammarRuleForOverriding(o,i),u=!0;const c=n.visit();return u=!1,s.override(o,a,c,null,i)},Rule_extend(t,e,r,n){o=t.visit(),a=e.children.map((t=>t.visit()))[0]||[];const i=n.visit(),u=this.source.trimmed();return s.extend(o,a,i,null,u)},RuleBody(t,e){return i.alt(...e.visit()).withSource(this.source)},OverrideRuleBody(t,e){const r=e.visit(),n=r.indexOf(Kt);if(n>=0){const t=r.slice(0,n),e=r.slice(n+1);return e.forEach((t=>{if(t===Kt)throw j("'...' can appear at most once in a rule body",t.source)})),new N(s.superGrammar,o,t,e).withSource(this.source)}return i.alt(...r).withSource(this.source)},Formals:(t,e,r)=>e.visit(),Params:(t,e,r)=>e.visit(),Alt(t){return i.alt(...t.visit()).withSource(this.source)},TopLevelTerm_inline(t,e){const r=o+"_"+e.visit(),n=t.visit(),c=this.source.trimmed(),l=!(s.superGrammar&&s.superGrammar.rules[r]);u&&!l?s.override(r,a,n,null,c):s.define(r,a,n,null,c);const p=a.map((t=>i.app(t)));return i.app(r,p).withSource(n.source)},OverrideTopLevelTerm_superSplice:t=>Kt,Seq(t){return i.seq(...t.children.map((t=>t.visit()))).withSource(this.source)},Iter_star(t,e){return i.star(t.visit()).withSource(this.source)},Iter_plus(t,e){return i.plus(t.visit()).withSource(this.source)},Iter_opt(t,e){return i.opt(t.visit()).withSource(this.source)},Pred_not(t,e){return i.not(e.visit()).withSource(this.source)},Pred_lookahead(t,e){return i.lookahead(e.visit()).withSource(this.source)},Lex_lex(t,e){return i.lex(e.visit()).withSource(this.source)},Base_application(t,e){const r=e.children.map((t=>t.visit()))[0]||[];return i.app(t.visit(),r).withSource(this.source)},Base_range(t,e,r){return i.range(t.visit(),r.visit()).withSource(this.source)},Base_terminal(t){return i.terminal(t.visit()).withSource(this.source)},Base_paren:(t,e,r)=>e.visit(),ruleDescr:(t,e,r)=>e.visit(),ruleDescrText(t){return this.sourceString.trim()},caseName:(t,e,r,n,i)=>r.visit(),name(t,e){return this.sourceString},nameFirst(t){},nameRest(t){},terminal:(t,e,r)=>e.children.map((t=>t.visit())).join(""),oneCharTerminal:(t,e,r)=>e.visit(),escapeChar(t){try{return d(this.sourceString)}catch(e){if(e instanceof RangeError&&e.message.startsWith("Invalid code point "))throw function(t){const e=t._node;r(e&&e.isNonterminal()&&"escapeChar_unicodeCodePoint"===e.ctorName);const n=t.children.slice(1,-1).map((t=>t.source)),i=n[0].coverageWith(...n.slice(1));return j(`U+${i.contents} is not a valid Unicode code point`,i)}(t);throw e}},NonemptyListOf:(t,e,r)=>[t.visit()].concat(r.children.map((t=>t.visit()))),EmptyListOf:()=>[],_terminal(){return this.sourceString}});return c(t).visit()}var Wt=Ut(["grammar",{source:'OperationsAndAttributes {\n\n  AttributeSignature =\n    name\n\n  OperationSignature =\n    name Formals?\n\n  Formals\n    = "(" ListOf<name, ","> ")"\n\n  name  (a name)\n    = nameFirst nameRest*\n\n  nameFirst\n    = "_"\n    | letter\n\n  nameRest\n    = "_"\n    | alnum\n\n}'},"OperationsAndAttributes",null,"AttributeSignature",{AttributeSignature:["define",{sourceInterval:[29,58]},null,[],["app",{sourceInterval:[54,58]},"name",[]]],OperationSignature:["define",{sourceInterval:[62,100]},null,[],["seq",{sourceInterval:[87,100]},["app",{sourceInterval:[87,91]},"name",[]],["opt",{sourceInterval:[92,100]},["app",{sourceInterval:[92,99]},"Formals",[]]]]],Formals:["define",{sourceInterval:[104,143]},null,[],["seq",{sourceInterval:[118,143]},["terminal",{sourceInterval:[118,121]},"("],["app",{sourceInterval:[122,139]},"ListOf",[["app",{sourceInterval:[129,133]},"name",[]],["terminal",{sourceInterval:[135,138]},","]]],["terminal",{sourceInterval:[140,143]},")"]]],name:["define",{sourceInterval:[147,187]},"a name",[],["seq",{sourceInterval:[168,187]},["app",{sourceInterval:[168,177]},"nameFirst",[]],["star",{sourceInterval:[178,187]},["app",{sourceInterval:[178,186]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[191,223]},null,[],["alt",{sourceInterval:[207,223]},["terminal",{sourceInterval:[207,210]},"_"],["app",{sourceInterval:[217,223]},"letter",[]]]],nameRest:["define",{sourceInterval:[227,257]},null,[],["alt",{sourceInterval:[242,257]},["terminal",{sourceInterval:[242,245]},"_"],["app",{sourceInterval:[252,257]},"alnum",[]]]]}]);!function(t){const e={empty(){return this.iteration()},nonEmpty(t,e,r){return this.iteration([t].concat(r.children))}};Pt.BuiltInSemantics=Pt.createSemantics(t,null).addOperation("asIteration",{emptyListOf:e.empty,nonemptyListOf:e.nonEmpty,EmptyListOf:e.empty,NonemptyListOf:e.nonEmpty})}(Gt.BuiltInRules),function(t){Pt.prototypeGrammarSemantics=t.createSemantics().addOperation("parse",{AttributeSignature:t=>({name:t.parse(),formals:[]}),OperationSignature:(t,e)=>({name:t.parse(),formals:e.children.map((t=>t.parse()))[0]||[]}),Formals:(t,e,r)=>e.asIteration().children.map((t=>t.parse())),name(t,e){return this.sourceString}}),Pt.prototypeGrammar=t}(Wt);const Jt="an indented block",Qt="a dedent",Zt=1114112;class Yt extends rt{constructor(t){super(t.input),this.state=t}_indentationAt(t){return this.state.userData[t]||0}atEnd(){return super.atEnd()&&0===this._indentationAt(this.pos)}next(){if(0===this._indentationAt(this.pos))return super.next();this.examinedLength=Math.max(this.examinedLength,this.pos)}nextCharCode(){return 0!==this._indentationAt(this.pos)?(this.examinedLength=Math.max(this.examinedLength,this.pos),Zt):super.nextCharCode()}nextCodePoint(){return 0!==this._indentationAt(this.pos)?(this.examinedLength=Math.max(this.examinedLength,this.pos),Zt):super.nextCodePoint()}}class Xt extends I{constructor(t=!0){super(),this.isIndent=t}allowsSkippingPrecedingSpace(){return!0}eval(t){const{inputStream:e}=t,r=t.userData;t.doNotMemoize=!0;const n=e.pos,i=this.isIndent?1:-1;return(r[n]||0)*i>0?(t.userData=Object.create(r),t.userData[n]-=i,t.pushBinding(new ft(0),n),!0):(t.processFailure(n,this),!1)}getArity(){return 1}_assertAllApplicationsAreValid(t,e){}_isNullable(t,e){return!1}assertChoicesHaveUniformArity(t){}assertIteratedExprsAreNotNullable(t){}introduceParams(t){return this}substituteParams(t){return this}toString(){return this.isIndent?"indent":"dedent"}toDisplayString(){return this.toString()}toFailure(t){const e=this.isIndent?Jt:Qt;return new St(this,e,"description")}}const te=new k("indent"),ee=new k("dedent"),re=new N($t,"any",[te,ee],[]),ne=(new qt).newGrammar("IndentationSensitive").withSuperGrammar($t).define("indent",[],new Xt(!0),Jt,void 0,!0).define("dedent",[],new Xt(!1),Qt,void 0,!0).extend("any",[],re,"any character",void 0).build();Object.assign(ne,{_matchStateInitializer(t){t.userData=function(t){let e=0;const r=[0],n=()=>r[r.length-1],i={},s=/( *).*(?:$|\r?\n|\r)/g;let o;for(;null!=(o=s.exec(t));){const[t,s]=o;if(0===t.length)break;const a=s.length,u=n(),c=e+a;if(a>u)r.push(a),i[c]=1;else if(a<u){const t=r.length;for(;n()!==a;)r.pop();i[c]=-1*(t-r.length)}e+=t.length}return r.length>1&&(i[e]=1-r.length),i}(t.input),t.inputStream=new Yt(t)},supportsIncrementalParsing:!1});Gt.initApplicationParser(zt,Vt);const ie=t=>!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t);function se(t,e){const r=zt.match(t,"Grammars");if(r.failed())throw function(t){const e=new Error;return Object.defineProperty(e,"message",{enumerable:!0,get:()=>t.message}),Object.defineProperty(e,"shortMessage",{enumerable:!0,get:()=>"Expected "+t.getExpectedText()}),e.interval=t.getInterval(),e}(r);return Vt(r,e)}function oe(t,e){const r=Object.create(e||{});if("string"!=typeof t){if(!ie(t))throw new TypeError("Expected string as first argument, got "+f(t));t=t.toString()}return se(t,r),r}t.ExperimentalIndentationSensitive=ne,t._buildGrammar=Vt,t.grammar=function(t,e){const r=oe(t,e),n=Object.keys(r);if(0===n.length)throw new Error("Missing grammar definition");if(n.length>1){const t=r[n[1]].source;throw new Error(X(t.sourceString,t.startIdx)+"Found more than one grammar definition -- use ohm.grammars() instead.")}return r[n[0]]},t.grammars=oe,t.makeRecipe=Ut,t.ohmGrammar=zt,t.pexprs=_t,t.version="17.1.0",Object.defineProperty(t,"__esModule",{value:!0})}));